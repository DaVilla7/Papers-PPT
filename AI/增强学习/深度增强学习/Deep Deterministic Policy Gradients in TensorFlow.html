<!DOCTYPE html>
<!-- saved from url=(0067)http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#Tensorflow -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Deep Deterministic Policy Gradients in TensorFlow</title>
  <meta name="description" content="">
  <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic|Source+Sans+Pro:400,700,200,300|Josefin+Sans:400,600,700,300" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" href="http://pemami4911.github.io/css/style.css">
  <link rel="canonical" href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html">
  <link rel="alternate" type="application/rss+xml" title="Patrick Emami" href="http://pemami4911.github.io/feed.xml">
  <script async="" src="https://www.google-analytics.com/analytics.js"></script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82749305-1', 'auto');
  ga('send', 'pageview');

</script>
  <script src="http://pemami4911.github.io/js/bower_components/jquery/dist/jquery.min.js"></script>
  <script src="http://pemami4911.github.io/js/bower_components/js/js.min.js"></script>
  <script src="http://pemami4911.github.io/js/list.js"></script>
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.mjx-chtml {display: inline-block; line-height: 0; text-indent: 0; text-align: left; text-transform: none; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; letter-spacing: normal; word-wrap: normal; word-spacing: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; margin: 0; padding: 1px 0}
.MJXc-display {display: block; text-align: center; margin: 1em 0; padding: 0}
.mjx-chtml[tabindex]:focus, body :focus .mjx-chtml[tabindex] {display: inline-table}
.mjx-full-width {text-align: center; display: table-cell!important; width: 10000em}
.mjx-math {display: inline-block; border-collapse: separate; border-spacing: 0}
.mjx-math * {display: inline-block; -webkit-box-sizing: content-box!important; -moz-box-sizing: content-box!important; box-sizing: content-box!important; text-align: left}
.mjx-numerator {display: block; text-align: center}
.mjx-denominator {display: block; text-align: center}
.MJXc-stacked {height: 0; position: relative}
.MJXc-stacked > * {position: absolute}
.MJXc-bevelled > * {display: inline-block}
.mjx-stack {display: inline-block}
.mjx-op {display: block}
.mjx-under {display: table-cell}
.mjx-over {display: block}
.mjx-over > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-under > * {padding-left: 0px!important; padding-right: 0px!important}
.mjx-stack > .mjx-sup {display: block}
.mjx-stack > .mjx-sub {display: block}
.mjx-prestack > .mjx-presup {display: block}
.mjx-prestack > .mjx-presub {display: block}
.mjx-delim-h > .mjx-char {display: inline-block}
.mjx-surd {vertical-align: top}
.mjx-mphantom * {visibility: hidden}
.mjx-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 2px 3px; font-style: normal; font-size: 90%}
.mjx-annotation-xml {line-height: normal}
.mjx-menclose > svg {fill: none; stroke: currentColor}
.mjx-mtr {display: table-row}
.mjx-mlabeledtr {display: table-row}
.mjx-mtd {display: table-cell; text-align: center}
.mjx-label {display: table-row}
.mjx-box {display: inline-block}
.mjx-block {display: block}
.mjx-span {display: inline}
.mjx-char {display: block; white-space: pre}
.mjx-itable {display: inline-table; width: auto}
.mjx-row {display: table-row}
.mjx-cell {display: table-cell}
.mjx-table {display: table; width: 100%}
.mjx-line {display: block; height: 0}
.mjx-strut {width: 0; padding-top: 1em}
.mjx-vsize {width: 0}
.MJXc-space1 {margin-left: .167em}
.MJXc-space2 {margin-left: .222em}
.MJXc-space3 {margin-left: .278em}
.mjx-chartest {display: block; visibility: hidden; position: absolute; top: 0; line-height: normal; font-size: 500%}
.mjx-chartest .mjx-char {display: inline}
.mjx-chartest .mjx-box {padding-top: 1000px}
.MJXc-processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MJXc-processed {display: none}
.mjx-test {display: block; font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.mjx-ex-box-test {position: absolute; width: 1px; height: 60ex}
.mjx-line-box-test {display: table!important}
.mjx-line-box-test span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
#MathJax_CHTML_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.mjx-chtml .mjx-noError {line-height: 1.2; vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
.MJXc-TeX-unknown-R {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: normal}
.MJXc-TeX-unknown-I {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: normal}
.MJXc-TeX-unknown-B {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: normal; font-weight: bold}
.MJXc-TeX-unknown-BI {font-family: STIXGeneral,'Cambria Math','Arial Unicode MS',serif; font-style: italic; font-weight: bold}
.MJXc-TeX-ams-R {font-family: MJXc-TeX-ams-R,MJXc-TeX-ams-Rw}
.MJXc-TeX-cal-B {font-family: MJXc-TeX-cal-B,MJXc-TeX-cal-Bx,MJXc-TeX-cal-Bw}
.MJXc-TeX-frak-R {font-family: MJXc-TeX-frak-R,MJXc-TeX-frak-Rw}
.MJXc-TeX-frak-B {font-family: MJXc-TeX-frak-B,MJXc-TeX-frak-Bx,MJXc-TeX-frak-Bw}
.MJXc-TeX-math-BI {font-family: MJXc-TeX-math-BI,MJXc-TeX-math-BIx,MJXc-TeX-math-BIw}
.MJXc-TeX-sans-R {font-family: MJXc-TeX-sans-R,MJXc-TeX-sans-Rw}
.MJXc-TeX-sans-B {font-family: MJXc-TeX-sans-B,MJXc-TeX-sans-Bx,MJXc-TeX-sans-Bw}
.MJXc-TeX-sans-I {font-family: MJXc-TeX-sans-I,MJXc-TeX-sans-Ix,MJXc-TeX-sans-Iw}
.MJXc-TeX-script-R {font-family: MJXc-TeX-script-R,MJXc-TeX-script-Rw}
.MJXc-TeX-type-R {font-family: MJXc-TeX-type-R,MJXc-TeX-type-Rw}
.MJXc-TeX-cal-R {font-family: MJXc-TeX-cal-R,MJXc-TeX-cal-Rw}
.MJXc-TeX-main-B {font-family: MJXc-TeX-main-B,MJXc-TeX-main-Bx,MJXc-TeX-main-Bw}
.MJXc-TeX-main-I {font-family: MJXc-TeX-main-I,MJXc-TeX-main-Ix,MJXc-TeX-main-Iw}
.MJXc-TeX-main-R {font-family: MJXc-TeX-main-R,MJXc-TeX-main-Rw}
.MJXc-TeX-math-I {font-family: MJXc-TeX-math-I,MJXc-TeX-math-Ix,MJXc-TeX-math-Iw}
.MJXc-TeX-size1-R {font-family: MJXc-TeX-size1-R,MJXc-TeX-size1-Rw}
.MJXc-TeX-size2-R {font-family: MJXc-TeX-size2-R,MJXc-TeX-size2-Rw}
.MJXc-TeX-size3-R {font-family: MJXc-TeX-size3-R,MJXc-TeX-size3-Rw}
.MJXc-TeX-size4-R {font-family: MJXc-TeX-size4-R,MJXc-TeX-size4-Rw}
@font-face {font-family: MJXc-TeX-ams-R; src: local('MathJax_AMS'), local('MathJax_AMS-Regular')}
@font-face {font-family: MJXc-TeX-ams-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_AMS-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-B; src: local('MathJax_Caligraphic Bold'), local('MathJax_Caligraphic-Bold')}
@font-face {font-family: MJXc-TeX-cal-Bx; src: local('MathJax_Caligraphic'); font-weight: bold}
@font-face {font-family: MJXc-TeX-cal-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-R; src: local('MathJax_Fraktur'), local('MathJax_Fraktur-Regular')}
@font-face {font-family: MJXc-TeX-frak-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-frak-B; src: local('MathJax_Fraktur Bold'), local('MathJax_Fraktur-Bold')}
@font-face {font-family: MJXc-TeX-frak-Bx; src: local('MathJax_Fraktur'); font-weight: bold}
@font-face {font-family: MJXc-TeX-frak-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Fraktur-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Fraktur-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Fraktur-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-BI; src: local('MathJax_Math BoldItalic'), local('MathJax_Math-BoldItalic')}
@font-face {font-family: MJXc-TeX-math-BIx; src: local('MathJax_Math'); font-weight: bold; font-style: italic}
@font-face {font-family: MJXc-TeX-math-BIw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Math-BoldItalic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-BoldItalic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-BoldItalic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-R; src: local('MathJax_SansSerif'), local('MathJax_SansSerif-Regular')}
@font-face {font-family: MJXc-TeX-sans-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-B; src: local('MathJax_SansSerif Bold'), local('MathJax_SansSerif-Bold')}
@font-face {font-family: MJXc-TeX-sans-Bx; src: local('MathJax_SansSerif'); font-weight: bold}
@font-face {font-family: MJXc-TeX-sans-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-sans-I; src: local('MathJax_SansSerif Italic'), local('MathJax_SansSerif-Italic')}
@font-face {font-family: MJXc-TeX-sans-Ix; src: local('MathJax_SansSerif'); font-style: italic}
@font-face {font-family: MJXc-TeX-sans-Iw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_SansSerif-Italic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_SansSerif-Italic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_SansSerif-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-script-R; src: local('MathJax_Script'), local('MathJax_Script-Regular')}
@font-face {font-family: MJXc-TeX-script-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Script-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Script-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Script-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-type-R; src: local('MathJax_Typewriter'), local('MathJax_Typewriter-Regular')}
@font-face {font-family: MJXc-TeX-type-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Typewriter-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Typewriter-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Typewriter-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-cal-R; src: local('MathJax_Caligraphic'), local('MathJax_Caligraphic-Regular')}
@font-face {font-family: MJXc-TeX-cal-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Caligraphic-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-B; src: local('MathJax_Main Bold'), local('MathJax_Main-Bold')}
@font-face {font-family: MJXc-TeX-main-Bx; src: local('MathJax_Main'); font-weight: bold}
@font-face {font-family: MJXc-TeX-main-Bw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Main-Bold.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-I; src: local('MathJax_Main Italic'), local('MathJax_Main-Italic')}
@font-face {font-family: MJXc-TeX-main-Ix; src: local('MathJax_Main'); font-style: italic}
@font-face {font-family: MJXc-TeX-main-Iw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Main-Italic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-main-R; src: local('MathJax_Main'), local('MathJax_Main-Regular')}
@font-face {font-family: MJXc-TeX-main-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Main-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-math-I; src: local('MathJax_Math Italic'), local('MathJax_Math-Italic')}
@font-face {font-family: MJXc-TeX-math-Ix; src: local('MathJax_Math'); font-style: italic}
@font-face {font-family: MJXc-TeX-math-Iw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Math-Italic.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size1-R; src: local('MathJax_Size1'), local('MathJax_Size1-Regular')}
@font-face {font-family: MJXc-TeX-size1-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Size1-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size2-R; src: local('MathJax_Size2'), local('MathJax_Size2-Regular')}
@font-face {font-family: MJXc-TeX-size2-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Size2-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size3-R; src: local('MathJax_Size3'), local('MathJax_Size3-Regular')}
@font-face {font-family: MJXc-TeX-size3-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Size3-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf') format('opentype')}
@font-face {font-family: MJXc-TeX-size4-R; src: local('MathJax_Size4'), local('MathJax_Size4-Regular')}
@font-face {font-family: MJXc-TeX-size4-Rw; src /*1*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/eot/MathJax_Size4-Regular.eot'); src /*2*/: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf') format('opentype')}
</style></head>


  <body><div id="MathJax_Message" style="display: none;"></div>

    
<div class="wrapper">
  <center> <a href="http://pemami4911.github.io/index.html"><div class="site-title">   Patrick Emami </div></a></center>
</div>
<div class="wrapper site-description">
<center>  My summaries of Machine Learning papers and investigations into various topics concerning artificial intelligence
 </center>
</div>
<div class="wrapper">
  <div class="trigger site-navigation">
   
    
      
      

      <a class="page-link" href="http://pemami4911.github.io/blog/">Blog</a>
      
      
          <span class="exclamationMark">/</span>
      

      
      
    
      
      

      <a class="page-link" href="http://pemami4911.github.io/cs-dojo/">CS Dojo</a>
      
      
          <span class="exclamationMark">/</span>
      

      
      
    
      
    
      
      

      <a class="page-link" href="http://pemami4911.github.io/">About Me</a>
      
      
          <span class="exclamationMark">/</span>
      

      
      
    
      
      

      <a class="page-link" href="http://pemami4911.github.io/paper-summaries/">Paper Summaries</a>
      
      
          <span class="exclamationMark">/</span>
      

      
      
    
      
    
      
    
      
      

      <a class="page-link" href="http://pemami4911.github.io/uf-ml/">UF ML Reading Group</a>
      
      

      
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html">Deep Deterministic Policy Gradients in TensorFlow</a></h1>
  <center>  <p class="post-meta"><time datetime="2016-08-21T00:00:00+00:00" itemprop="datePublished">Aug 21, 2016</time></p>
    
    

    <!-- Sharingbutton Facebook -->
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M18.768,7.465H14.5V5.56c0-0.896,0.594-1.105,1.012-1.105s2.988,0,2.988,0V0.513L14.171,0.5C10.244,0.5,9.5,3.438,9.5,5.32 v2.145h-3v4h3c0,5.212,0,12,0,12h5c0,0,0-6.85,0-12h3.851L18.768,7.465z"></path>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton Twitter -->
<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Deep%20Deterministic%20Policy%20Gradients%20in%20TensorFlow%20by%20@patrickomid%20&amp;url=http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M23.444,4.834c-0.814,0.363-1.5,0.375-2.228,0.016c0.938-0.562,0.981-0.957,1.32-2.019c-0.878,0.521-1.851,0.9-2.886,1.104 C18.823,3.053,17.642,2.5,16.335,2.5c-2.51,0-4.544,2.036-4.544,4.544c0,0.356,0.04,0.703,0.117,1.036 C8.132,7.891,4.783,6.082,2.542,3.332C2.151,4.003,1.927,4.784,1.927,5.617c0,1.577,0.803,2.967,2.021,3.782 C3.203,9.375,2.503,9.171,1.891,8.831C1.89,8.85,1.89,8.868,1.89,8.888c0,2.202,1.566,4.038,3.646,4.456 c-0.666,0.181-1.368,0.209-2.053,0.079c0.579,1.804,2.257,3.118,4.245,3.155C5.783,18.102,3.372,18.737,1,18.459 C3.012,19.748,5.399,20.5,7.966,20.5c8.358,0,12.928-6.924,12.928-12.929c0-0.198-0.003-0.393-0.012-0.588 C21.769,6.343,22.835,5.746,23.444,4.834z"></path>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton Google+ -->
<a class="resp-sharing-button__link" href="https://plus.google.com/share?url=http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M11.366,12.928c-0.729-0.516-1.393-1.273-1.404-1.505c0-0.425,0.038-0.627,0.988-1.368 c1.229-0.962,1.906-2.228,1.906-3.564c0-1.212-0.37-2.289-1.001-3.044h0.488c0.102,0,0.2-0.033,0.282-0.091l1.364-0.989 c0.169-0.121,0.24-0.338,0.176-0.536C14.102,1.635,13.918,1.5,13.709,1.5H7.608c-0.667,0-1.345,0.118-2.011,0.347 c-2.225,0.766-3.778,2.66-3.778,4.605c0,2.755,2.134,4.845,4.987,4.91c-0.056,0.22-0.084,0.434-0.084,0.645 c0,0.425,0.108,0.827,0.33,1.216c-0.026,0-0.051,0-0.079,0c-2.72,0-5.175,1.334-6.107,3.32C0.623,17.06,0.5,17.582,0.5,18.098 c0,0.501,0.129,0.984,0.382,1.438c0.585,1.046,1.843,1.861,3.544,2.289c0.877,0.223,1.82,0.335,2.8,0.335 c0.88,0,1.718-0.114,2.494-0.338c2.419-0.702,3.981-2.482,3.981-4.538C13.701,15.312,13.068,14.132,11.366,12.928z M3.66,17.443 c0-1.435,1.823-2.693,3.899-2.693h0.057c0.451,0.005,0.892,0.072,1.309,0.2c0.142,0.098,0.28,0.192,0.412,0.282 c0.962,0.656,1.597,1.088,1.774,1.783c0.041,0.175,0.063,0.35,0.063,0.519c0,1.787-1.333,2.693-3.961,2.693 C5.221,20.225,3.66,19.002,3.66,17.443z M5.551,3.89c0.324-0.371,0.75-0.566,1.227-0.566l0.055,0 c1.349,0.041,2.639,1.543,2.876,3.349c0.133,1.013-0.092,1.964-0.601,2.544C8.782,9.589,8.363,9.783,7.866,9.783H7.865H7.844 c-1.321-0.04-2.639-1.6-2.875-3.405C4.836,5.37,5.049,4.462,5.551,3.89z"></path>
            <polygon points="23.5,9.5 20.5,9.5 20.5,6.5 18.5,6.5 18.5,9.5 15.5,9.5 15.5,11.5 18.5,11.5 18.5,14.5 20.5,14.5 20.5,11.5  23.5,11.5   "></polygon>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton E-Mail -->
<a class="resp-sharing-button__link" href="mailto:?subject=Deep%20Deterministic%20Policy%20Gradients%20in%20TensorFlow&amp;body=http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html" target="_self" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <path d="M22,4H2C0.897,4,0,4.897,0,6v12c0,1.103,0.897,2,2,2h20c1.103,0,2-0.897,2-2V6C24,4.897,23.103,4,22,4z M7.248,14.434 l-3.5,2C3.67,16.479,3.584,16.5,3.5,16.5c-0.174,0-0.342-0.09-0.435-0.252c-0.137-0.239-0.054-0.545,0.186-0.682l3.5-2 c0.24-0.137,0.545-0.054,0.682,0.186C7.571,13.992,7.488,14.297,7.248,14.434z M12,14.5c-0.094,0-0.189-0.026-0.271-0.08l-8.5-5.5 C2.997,8.77,2.93,8.46,3.081,8.229c0.15-0.23,0.459-0.298,0.691-0.147L12,13.405l8.229-5.324c0.232-0.15,0.542-0.084,0.691,0.147 c0.15,0.232,0.083,0.542-0.148,0.691l-8.5,5.5C12.189,14.474,12.095,14.5,12,14.5z M20.934,16.248 C20.842,16.41,20.673,16.5,20.5,16.5c-0.084,0-0.169-0.021-0.248-0.065l-3.5-2c-0.24-0.137-0.323-0.442-0.186-0.682 s0.443-0.322,0.682-0.186l3.5,2C20.988,15.703,21.071,16.009,20.934,16.248z"></path>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton LinkedIn -->
<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <g>
            <path d="M6.527,21.5h-5v-13h5V21.5z M4.018,6.5H3.988C2.478,6.5,1.5,5.318,1.5,4.019c0-1.329,1.008-2.412,2.547-2.412 c1.541,0,2.488,1.118,2.519,2.447C6.565,5.354,5.588,6.5,4.018,6.5z M15.527,12.5c-1.105,0-2,0.896-2,2v7h-5c0,0,0.059-12,0-13h5 v1.485c0,0,1.548-1.443,3.938-1.443c2.962,0,5.062,2.144,5.062,6.304V21.5h-5v-7C17.527,13.396,16.632,12.5,15.527,12.5z"></path>
        </g>
    </svg>
    </div>
  </div>
</a>

<!-- Sharingbutton Reddit -->
<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html" target="_blank" aria-label="">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
        <path d="M24,11.5c0-1.654-1.346-3-3-3c-0.964,0-1.863,0.476-2.422,1.241c-1.639-1.006-3.747-1.64-6.064-1.723 c0.064-1.11,0.4-3.049,1.508-3.686c0.72-0.414,1.733-0.249,3.01,0.478C17.189,6.317,18.452,7.5,20,7.5c1.654,0,3-1.346,3-3 s-1.346-3-3-3c-1.382,0-2.536,0.944-2.883,2.217C15.688,3,14.479,2.915,13.521,3.466c-1.642,0.945-1.951,3.477-2.008,4.551 C9.186,8.096,7.067,8.731,5.422,9.741C4.863,8.976,3.964,8.5,3,8.5c-1.654,0-3,1.346-3,3c0,1.319,0.836,2.443,2.047,2.844 C2.019,14.56,2,14.778,2,15c0,3.86,4.486,7,10,7s10-3.14,10-7c0-0.222-0.019-0.441-0.048-0.658C23.148,13.938,24,12.795,24,11.5z  M2.286,13.366C1.522,13.077,1,12.351,1,11.5c0-1.103,0.897-2,2-2c0.635,0,1.217,0.318,1.59,0.816 C3.488,11.17,2.683,12.211,2.286,13.366z M6,13.5c0-1.103,0.897-2,2-2s2,0.897,2,2c0,1.103-0.897,2-2,2S6,14.603,6,13.5z  M15.787,18.314c-1.063,0.612-2.407,0.949-3.787,0.949c-1.387,0-2.737-0.34-3.803-0.958c-0.239-0.139-0.321-0.444-0.182-0.683 c0.139-0.24,0.444-0.322,0.683-0.182c1.828,1.059,4.758,1.062,6.59,0.008c0.239-0.138,0.545-0.055,0.683,0.184 C16.108,17.871,16.026,18.177,15.787,18.314z M16,15.5c-1.103,0-2-0.897-2-2c0-1.103,0.897-2,2-2s2,0.897,2,2 C18,14.603,17.103,15.5,16,15.5z M21.713,13.365c-0.397-1.155-1.201-2.195-2.303-3.048C19.784,9.818,20.366,9.5,21,9.5 c1.103,0,2,0.897,2,2C23,12.335,22.468,13.073,21.713,13.365z"></path>
    </svg>
    </div>
  </div>
</a>


    <div class="PageNavigation">
      
      
      
      
    </div>

   </center>
  </header>

  <div class="post-content" itemprop="articleBody">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" id="">
</script>

<script type="text/x-mathjax-config;executed=true">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } },
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>

<hr>

<h2 id="introduction">Introduction</h2>

<p>Deep Reinforcement Learning has recently gained a lot of traction in the machine learning community due to the significant amount of progress that has been made in the past few years. Traditionally, reinforcement learning algorithms were constrained to tiny, discretized grid worlds, which seriously inhibited them from gaining credibility as being viable machine learning tools.
Here’s a classic example from <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">Richard Sutton’s book</a><a></a>, which I will be referencing a lot.</p>

<div>
	<div class="image-wrapper">
	
	<img src="http://pemami4911.github.io/img/classic_rl.jpg" alt="" width="" height="">
	
	</div>
	<div>
	
	<p class="image-caption">Cliff-walking task, Fig. 6.13 from [6]</p>
	
	</div>
</div>

<p>After Deep Q-Networks <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[4]</a> became a hit, people realized that deep learning methods could be used to solve high-dimensional problems. One of the subsequent challenges that the reinforcement learning community faced was figuring out how to deal with continuous action spaces. This is a significant obstacle, <strong>since most interesting problems in robotic control, etc., fall into this category</strong>. Logically, if you discretize your continuous action space too finely, you end up with the same curse of dimensionality problem as before. On the other hand, a naive discretization of the action space throws away valuable information concerning the geometry of the action domain.</p>

<div>
	<div class="image-wrapper">
	
	<img src="http://pemami4911.github.io/img/cartpole.gif" alt="" width="" height="">
	
	</div>
	<div>
	
	<p class="image-caption">CartPole-v0 environment: OpenAI Gym</p>
	
	</div>
</div>

<p>Google DeepMind has devised a solid algorithm for tackling the continuous action space problem. Building off the prior work of <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[3]</a> on Deterministic Policy Gradients, they have produced a <strong>policy-gradient</strong> <strong>actor-critic</strong> algorithm called Deep Deterministic Policy Gradients (DDPG) <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[5]</a> that is <strong>off-policy</strong> and <strong>model-free</strong>, and that uses some of the deep learning tricks that were introduced along with Deep Q-Networks (hence the “deep”-ness of DDPG). In this blog post, we’re going to discuss how to implement this algorithm using Tensorflow and tflearn, and then evaluate it with <a href="https://gym.openai.com/">OpenAI Gym</a> on the pendulum environment. I’ll also discuss some of the theory behind it. Regrettably, I can’t start with introducing the basics of reinforcement learning since that would make this blog post much too long; however, Richard Sutton’s book (linked above), as well as <a href="http://www0.cs.ucl.ac.uk/staff/d.silver/web/Teaching.html">David Silver’s course</a>, are excellent resources to get going with RL.</p>

<h2 id="lets-start-with-some-theory">Lets Start With Some Theory</h2>

<p><a href="./Deep Deterministic Policy Gradients in TensorFlow_files/Deep Deterministic Policy Gradients in TensorFlow.html">[Wait, I just want to skip to the Tensorflow part!]</a></p>

<h3 id="policy-gradient-methods">Policy-Gradient Methods</h3>

<p>Policy-Gradient (PG) algorithms optimize a policy end-to-end by computing noisy estimates of the gradient of the expected reward of the policy and then updating the policy in the gradient direction. Traditionally, PG methods have assumed a stochastic policy <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-1-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-1" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-2" class="mjx-mrow"><span id="MJXc-Node-3" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.499em;">μ</span></span><span id="MJXc-Node-4" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-5" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">a</span></span><span id="MJXc-Node-6" class="mjx-texatom"><span id="MJXc-Node-7" class="mjx-mrow"><span id="MJXc-Node-8" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">|</span></span></span></span><span id="MJXc-Node-9" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">s</span></span><span id="MJXc-Node-10" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mo stretchy="false">(</mo><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>s</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1">\mu (a | s)</script>, which gives a probability distribution over actions. Ideally, the algorithm sees lots of training examples of high rewards from good actions and negative rewards from bad actions. Then, it can increase the probability of the good actions. In practice, you tend to run into plenty of problems with vanilla-PG; for example, getting one reward signal at the end of a long episode of interaction with the environment makes it difficult to ascertain exactly which action was the good one. This is known as the <em>credit assignment problem</em>. For RL problems with continuous action spaces, vanilla-PG is all but useless. You can, however, get vanilla-PG to work with some RL domains that take in visual inputs and have discrete action spaces with a convolutional neural network representing your policy (talk about standing on the shoulders of giants!). There are extensions to the vanilla-PG algorithm such as <a href="https://webdocs.cs.ualberta.ca/~sutton/williams-92.pdf">REINFORCE</a> and <a href="http://papers.nips.cc/paper/2073-a-natural-policy-gradient.pdf">Natural Policy Gradients</a> that make the algorithm much more viable. For a first look into stochastic policy gradients, you can find an overview of the Stochastic Policy Gradient theorem in <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[3]</a>, an in-depth blog post by Andrej Karpathy on <a href="http://karpathy.github.io/2016/05/31/rl/">here</a>, and a nice explanation from OpenAI <a href="https://gym.openai.com/docs/rl#Policy-Gradients">here</a>.</p>

<h3 id="actor-critic-algorithms">Actor-Critic Algorithms</h3>

<div>
	<div class="image-wrapper">
	
	<img src="http://pemami4911.github.io/img/actor-critic.png" alt="" width="" height="">
	
	</div>
	<div>
	
	<p class="image-caption">The actor-critic architecture, Fig. 6.15 from [2]</p>
	
	</div>
</div>

<p>The Actor-Critic learning algorithm is used to represent the policy function independently of the value function. The policy function structure is known as the <em>actor</em>, and the value function structure is referred to as the <em>critic</em>. The actor produces an action given the current state of the environment, and the critic produces a TD (Temporal-Difference) error signal given the state and resultant reward. If the critic is estimating the action-value function <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-2-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-11" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-12" class="mjx-mrow"><span id="MJXc-Node-13" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.461em;">Q</span></span><span id="MJXc-Node-14" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-15" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">s</span></span><span id="MJXc-Node-16" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.151em; padding-bottom: 0.537em;">,</span></span><span id="MJXc-Node-17" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">a</span></span><span id="MJXc-Node-18" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-2">Q(s,a)</script>, it will also need the output of the actor.  The output of the critic drives learning in both the actor and the critic. In Deep Reinforcement Learning, neural networks can be used to represent the actor and critic structures.</p>

<h3 id="off-policy-vs-on-policy">Off-Policy vs. On-Policy</h3>

<p>Reinforcement Learning algorithms which are characterized as off-policy generally employ a separate behavior policy that is independent of the policy being improved upon; the behavior policy is used to simulate trajectories. A key benefit of this separation is that the behavior policy can operate by sampling all actions, whereas the estimation policy can be deterministic (e.g., greedy) <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[1]</a>. Q-learning is an off-policy algorithm, since it updates the Q values without making any assumptions about the actual policy being followed. Rather, the Q-learning algorithm simply states that the Q-value corresponding to state <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-3-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-19" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-20" class="mjx-mrow"><span id="MJXc-Node-21" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">s</span></span><span id="MJXc-Node-22" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-23" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.384em; padding-bottom: 0.269em;">t</span></span><span id="MJXc-Node-24" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">s(t)</script> and action <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-4-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-25" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-26" class="mjx-mrow"><span id="MJXc-Node-27" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">a</span></span><span id="MJXc-Node-28" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-29" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.384em; padding-bottom: 0.269em;">t</span></span><span id="MJXc-Node-30" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">a(t)</script> is updated using the Q-value of the next state <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-5-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-31" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-32" class="mjx-mrow"><span id="MJXc-Node-33" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">s</span></span><span id="MJXc-Node-34" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-35" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.384em; padding-bottom: 0.269em;">t</span></span><span id="MJXc-Node-36" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.422em;">+</span></span><span id="MJXc-Node-37" class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">1</span></span><span id="MJXc-Node-38" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">s(t + 1)</script> and the action <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-6-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-39" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-40" class="mjx-mrow"><span id="MJXc-Node-41" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">a</span></span><span id="MJXc-Node-42" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-43" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.384em; padding-bottom: 0.269em;">t</span></span><span id="MJXc-Node-44" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.422em;">+</span></span><span id="MJXc-Node-45" class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">1</span></span><span id="MJXc-Node-46" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-6">a(t + 1)</script> that maximizes the Q-value at state <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-7-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-47" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-48" class="mjx-mrow"><span id="MJXc-Node-49" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">s</span></span><span id="MJXc-Node-50" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-51" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.384em; padding-bottom: 0.269em;">t</span></span><span id="MJXc-Node-52" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.422em;">+</span></span><span id="MJXc-Node-53" class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">1</span></span><span id="MJXc-Node-54" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-7">s(t + 1)</script>.</p>

<p>On-policy algorithms directly use the policy that is being estimated to sample trajectories during training.</p>

<h3 id="model-free-algorithms">Model-free Algorithms</h3>

<p>Model-free RL algorithms are those that make no effort to learn the underlying dynamics that govern how an agent interacts with the environment. In the case where the environment has a discrete state space and the agent has a discrete number of actions to choose from, a model of the dynamics of the environment is the 1-step transition matrix: <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-8-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-55" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-56" class="mjx-mrow"><span id="MJXc-Node-57" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.269em; padding-right: 0.12em;">T</span></span><span id="MJXc-Node-58" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-59" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">s</span></span><span id="MJXc-Node-60" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-61" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.384em; padding-bottom: 0.269em;">t</span></span><span id="MJXc-Node-62" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.422em;">+</span></span><span id="MJXc-Node-63" class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">1</span></span><span id="MJXc-Node-64" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span><span id="MJXc-Node-65" class="mjx-texatom"><span id="MJXc-Node-66" class="mjx-mrow"><span id="MJXc-Node-67" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">|</span></span></span></span><span id="MJXc-Node-68" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">s</span></span><span id="MJXc-Node-69" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-70" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.384em; padding-bottom: 0.269em;">t</span></span><span id="MJXc-Node-71" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span><span id="MJXc-Node-72" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.151em; padding-bottom: 0.537em;">,</span></span><span id="MJXc-Node-73" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">a</span></span><span id="MJXc-Node-74" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-75" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.384em; padding-bottom: 0.269em;">t</span></span><span id="MJXc-Node-76" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span><span id="MJXc-Node-77" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>s</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>,</mo><mi>a</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-8">T(s(t + 1)|s(t), a(t))</script>. This stochastic matrix gives all of the probabilities for arriving at a desired state given the current state and action. Clearly, for problems with high-dimensional state and action spaces, this matrix is incredibly expensive in space and time to compute. If your state space is the set of all possible 64 x 64 RGB images and your agent has 18 actions available to it, the transition matrix’s size is  <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-9-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2248;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;68.7&lt;/mn&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;msup&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;9&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;68.7&lt;/mn&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;msup&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;mn&gt;9&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mn&gt;18&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-78" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-79" class="mjx-mrow"><span id="MJXc-Node-80" class="mjx-texatom"><span id="MJXc-Node-81" class="mjx-mrow"><span id="MJXc-Node-82" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">|</span></span></span></span><span id="MJXc-Node-83" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.308em; padding-right: 0.032em;">S</span></span><span id="MJXc-Node-84" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.193em; padding-bottom: 0.346em;">×</span></span><span id="MJXc-Node-85" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.308em; padding-right: 0.032em;">S</span></span><span id="MJXc-Node-86" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.193em; padding-bottom: 0.346em;">×</span></span><span id="MJXc-Node-87" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.269em;">A</span></span><span id="MJXc-Node-88" class="mjx-texatom"><span id="MJXc-Node-89" class="mjx-mrow"><span id="MJXc-Node-90" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">|</span></span></span></span><span id="MJXc-Node-91" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.193em; padding-bottom: 0.308em;">≈</span></span><span id="MJXc-Node-92" class="mjx-texatom MJXc-space3"><span id="MJXc-Node-93" class="mjx-mrow"><span id="MJXc-Node-94" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">|</span></span></span></span><span id="MJXc-Node-95" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-96" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">68.7</span></span><span id="MJXc-Node-97" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.193em; padding-bottom: 0.346em;">×</span></span><span id="MJXc-Node-98" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-99" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">10</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-100" class="mjx-texatom"><span id="MJXc-Node-101" class="mjx-mrow"><span id="MJXc-Node-102" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">9</span></span></span></span></span></span><span id="MJXc-Node-103" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span><span id="MJXc-Node-104" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.193em; padding-bottom: 0.346em;">×</span></span><span id="MJXc-Node-105" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-106" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">68.7</span></span><span id="MJXc-Node-107" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.193em; padding-bottom: 0.346em;">×</span></span><span id="MJXc-Node-108" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-109" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">10</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-110" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">9</span></span></span></span><span id="MJXc-Node-111" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span><span id="MJXc-Node-112" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.193em; padding-bottom: 0.346em;">×</span></span><span id="MJXc-Node-113" class="mjx-mn MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">18</span></span><span id="MJXc-Node-114" class="mjx-texatom"><span id="MJXc-Node-115" class="mjx-mrow"><span id="MJXc-Node-116" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">|</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>S</mi><mo>×</mo><mi>S</mi><mo>×</mo><mi>A</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mo>≈</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mo stretchy="false">(</mo><mn>68.7</mn><mo>×</mo><msup><mn>10</mn><mrow class="MJX-TeXAtom-ORD"><mn>9</mn></mrow></msup><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mn>68.7</mn><mo>×</mo><msup><mn>10</mn><mn>9</mn></msup><mo stretchy="false">)</mo><mo>×</mo><mn>18</mn><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-9">|S \times S \times A| \approx |(68.7 \times 10^{9}) \times (68.7 \times 10^9) \times 18|</script>, and at 32 bits per matrix element, thats around <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-10-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;3.4&lt;/mn&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;msup&gt;&lt;mn&gt;10&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mn&gt;14&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-117" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-118" class="mjx-mrow"><span id="MJXc-Node-119" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">3.4</span></span><span id="MJXc-Node-120" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.193em; padding-bottom: 0.346em;">×</span></span><span id="MJXc-Node-121" class="mjx-msubsup MJXc-space2"><span class="mjx-base"><span id="MJXc-Node-122" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">10</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.591em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-123" class="mjx-texatom"><span id="MJXc-Node-124" class="mjx-mrow"><span id="MJXc-Node-125" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.346em;">14</span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3.4</mn><mo>×</mo><msup><mn>10</mn><mrow class="MJX-TeXAtom-ORD"><mn>14</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-10">3.4 \times 10^{14}</script> GB to store it in RAM!</p>

<p>Rather than dealing with all of that, model-free algorithms directly estimate the optimal policy or value function through algorithms such as policy iteration or value iteration. This is much more computationally efficient. I should note that, if possible, obtaining and using a good approximation of the underlying model of the environment can only be beneficial. Be wary- using a bad approximation of a model of the environment will only bring you misery. Just as well, model-free methods generally require a larger number of training examples.</p>

<h2 id="the-meat-and-potatoes-of-ddpg">The Meat and Potatoes of DDPG</h2>

<p>At its core, DDPG is a policy gradient algorithm that uses a stochastic behavior policy for good exploration but estimates a <strong>deterministic</strong> target policy, which is much easier to learn. Policy gradient algorithms utilize a form of policy iteration: they evaluate the policy, and then follow the policy gradient to maximize performance. Since DDPG is off-policy and uses a deterministic target policy, this allows for the use of the Deterministic Policy Gradient theorem (which will be derived shortly). DDPG is an actor-critic algorithm as well; it primarily uses two neural networks, one for the actor and one for the critic. These networks compute action predictions for the current state and generate a temporal-difference (TD) error signal each time step. The input of the actor network is the current state, and the output is a single real value representing an action chosen from a <strong>continuous</strong> action space (whoa!). The critic’s output is simply the estimated Q-value of the current state and of the action given by the actor. The deterministic policy gradient theorem provides the update rule for the weights of the actor network. The critic network is updated from the gradients obtained from the TD error signal.</p>

<p>Sadly, it turns out that tossing neural networks at DPG results in an algorithm that behaves poorly, resisting all of your most valiant efforts to get it to converge. The following are most likely some of the key conspirators:</p>

<ol>
  <li>
    <p>In general, training and evaluating your policy and/or value function with thousands of temporally-correlated simulated trajectories leads to the introduction of enormous amounts of variance in your approximation of the true Q-function (the critic). The TD error signal is excellent at compounding the variance introduced by your bad predictions over time. It is highly suggested to use a replay buffer to store the <strong>experiences</strong> of the agent during training, and then randomly sample experiences to use for learning in order to break up the temporal correlations within different training episodes. This technique is known as <strong>experience replay</strong>. DDPG uses this.</p>
  </li>
  <li>
    <p>Directly updating your actor and critic neural network weights with the gradients obtained from the TD error signal that was computed from both your replay buffer and the output of the actor and critic networks causes your learning algorithm to diverge (or to not learn at all). It was recently discovered that using a set of <strong>target networks</strong> to generate the <strong>targets</strong> for your TD error computation regularizes your learning algorithm and increases stability. Accordingly, here are the equations for the TD target <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-11-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-126" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-127" class="mjx-mrow"><span id="MJXc-Node-128" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-129" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.499em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-130" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.422em; padding-bottom: 0.269em;">i</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-11">y_i</script> and the loss function for the critic network:</p>
  </li>
</ol>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display"><span id="MathJax-Element-12-Frame" class="mjx-full-width mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-1&quot;&gt;&lt;mtext&gt;(1)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; min-width: 14.632em; position: relative;"><span id="MJXc-Node-131" class="mjx-math" aria-hidden="true" style="width: 100%;"><span id="MJXc-Node-132" class="mjx-mrow" style="width: 100%;"><span id="MJXc-Node-133" class="mjx-mtable" style="width: 100%; min-width: 18.788em;"><span class="mjx-box" style="width: 100%; text-align: center;"><span class="mjx-table" style="display: inline-table; width: auto; vertical-align: -0.093em;"><span id="MJXc-Node-134" class="mjx-mlabeledtr" style="height: 1.237em;"><span id="MJXc-Node-138" class="mjx-mtd" style="padding: 0px; width: 14.632em;"><span id="MJXc-Node-139" class="mjx-mrow" style="margin-top: -0.038em;"><span id="MJXc-Node-140" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-141" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.461em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-142" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">i</span></span></span></span><span id="MJXc-Node-143" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-144" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-145" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">r</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-146" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">i</span></span></span></span><span id="MJXc-Node-147" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.41em;">+</span></span><span id="MJXc-Node-148" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em; padding-right: 0.025em;">γ</span></span><span id="MJXc-Node-149" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-150" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-151" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span></span></span><span id="MJXc-Node-152" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-153" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-154" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-155" class="mjx-texatom"><span id="MJXc-Node-156" class="mjx-mrow"><span id="MJXc-Node-157" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">i</span></span><span id="MJXc-Node-158" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.41em;">+</span></span><span id="MJXc-Node-159" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.359em; padding-bottom: 0.359em;">1</span></span></span></span></span></span><span id="MJXc-Node-160" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-161" class="mjx-msup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-162" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-163" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span></span></span><span id="MJXc-Node-164" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-165" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-166" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-167" class="mjx-texatom"><span id="MJXc-Node-168" class="mjx-mrow"><span id="MJXc-Node-169" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">i</span></span><span id="MJXc-Node-170" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.41em;">+</span></span><span id="MJXc-Node-171" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.359em; padding-bottom: 0.359em;">1</span></span></span></span></span></span><span id="MJXc-Node-172" class="mjx-texatom"><span id="MJXc-Node-173" class="mjx-mrow"><span id="MJXc-Node-174" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-175" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-176" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-177" class="mjx-texatom"><span id="MJXc-Node-178" class="mjx-mrow"><span id="MJXc-Node-179" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-180" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-181" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span></span></span></span></span></span></span><span id="MJXc-Node-182" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-183" class="mjx-texatom"><span id="MJXc-Node-184" class="mjx-mrow"><span id="MJXc-Node-185" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-186" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-187" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-188" class="mjx-texatom"><span id="MJXc-Node-189" class="mjx-mrow"><span id="MJXc-Node-190" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-191" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-192" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span></span></span></span></span></span></span><span id="MJXc-Node-193" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span class="mjx-strut"></span></span></span></span></span></span><span class="mjx-itable" style="vertical-align: top; margin-left: -1.278em;"><span class="mjx-label" style="height: 1.237em;"><span id="mjx-eqn-1" class="mjx-mtd"><span id="MJXc-Node-136" class="mjx-mrow" style="margin-top: -0.038em;"><span id="MJXc-Node-137" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(1)</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-1"><mtext>(1)</mtext></mtd><mtd><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>r</mi><mi>i</mi></msub><mo>+</mo><mi>γ</mi><msup><mi>Q</mi><mo>′</mo></msup><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msup><mi>μ</mi><mo>′</mo></msup><mo stretchy="false">(</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>μ</mi><mo>′</mo></msup></mrow></msup><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>Q</mi><mo>′</mo></msup></mrow></msup><mo stretchy="false">)</mo></mtd></mlabeledtr></mtable></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-12">\begin{equation}
y_i = r_i + \gamma Q'(s_{i + 1}, \mu'(s_{i+1}|\theta^{\mu'})|\theta^{Q'})
\end{equation}</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display"><span id="MathJax-Element-13-Frame" class="mjx-full-width mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-2&quot;&gt;&lt;mtext&gt;(2)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mfrac&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; min-width: 12.857em; position: relative;"><span id="MJXc-Node-194" class="mjx-math" aria-hidden="true" style="width: 100%;"><span id="MJXc-Node-195" class="mjx-mrow" style="width: 100%;"><span id="MJXc-Node-196" class="mjx-mtable" style="width: 100%; min-width: 17.013em;"><span class="mjx-box" style="width: 100%; text-align: center;"><span class="mjx-table" style="display: inline-table; width: auto; vertical-align: 0.192em;"><span id="MJXc-Node-197" class="mjx-mlabeledtr" style="height: 2.62em;"><span id="MJXc-Node-201" class="mjx-mtd" style="padding: 0px; width: 12.857em;"><span id="MJXc-Node-202" class="mjx-mrow"><span id="MJXc-Node-203" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.257em;">L</span></span><span id="MJXc-Node-204" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-205" class="mjx-mfrac MJXc-space3"><span class="mjx-box MJXc-stacked" style="width: 1.088em; padding: 0px 0.12em;"><span class="mjx-numerator" style="width: 1.088em; top: -1.368em;"><span id="MJXc-Node-206" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.359em; padding-bottom: 0.359em;">1</span></span></span><span class="mjx-denominator" style="width: 1.088em; bottom: -0.711em;"><span id="MJXc-Node-207" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.257em; padding-right: 0.085em;">N</span></span></span><span class="mjx-line" style="border-bottom-width: 1.3px; border-bottom-style: solid; top: -0.282em; width: 1.088em;"></span></span><span class="mjx-vsize" style="height: 2.078em; vertical-align: -0.711em;"></span></span><span id="MJXc-Node-208" class="mjx-munderover MJXc-space1"><span class="mjx-itable"><span class="mjx-row"><span class="mjx-cell"><span class="mjx-op"><span id="MJXc-Node-209" class="mjx-mo"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 0.716em; padding-bottom: 0.716em;">∑</span></span></span></span></span><span class="mjx-row"><span class="mjx-under" style="font-size: 70.7%; padding-top: 0.236em; padding-bottom: 0.141em; padding-left: 0.849em;"><span id="MJXc-Node-210" class="mjx-texatom"><span id="MJXc-Node-211" class="mjx-mrow"><span id="MJXc-Node-212" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">i</span></span></span></span></span></span></span></span><span id="MJXc-Node-213" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-214" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-215" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.461em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-216" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">i</span></span></span></span><span id="MJXc-Node-217" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.41em;">−</span></span><span id="MJXc-Node-218" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span><span id="MJXc-Node-219" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-220" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-221" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-222" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">i</span></span></span></span><span id="MJXc-Node-223" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-224" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-225" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-226" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">i</span></span></span></span><span id="MJXc-Node-227" class="mjx-texatom"><span id="MJXc-Node-228" class="mjx-mrow"><span id="MJXc-Node-229" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-230" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-231" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-232" class="mjx-texatom"><span id="MJXc-Node-233" class="mjx-mrow"><span id="MJXc-Node-234" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span></span></span></span></span><span id="MJXc-Node-235" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-236" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-237" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.359em; padding-bottom: 0.359em;">2</span></span></span></span><span id="MJXc-Node-238" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span class="mjx-strut"></span></span></span></span></span></span><span class="mjx-itable" style="vertical-align: top; margin-left: -1.278em;"><span class="mjx-label" style="height: 2.62em;"><span id="mjx-eqn-2" class="mjx-mtd"><span id="MJXc-Node-199" class="mjx-mrow" style="margin-top: 0.368em;"><span id="MJXc-Node-200" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(2)</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-2"><mtext>(2)</mtext></mtd><mtd><mi>L</mi><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></munder><mo stretchy="false">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo>,</mo><msub><mi>a</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>Q</mi></mrow></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mtd></mlabeledtr></mtable></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-13">\begin{equation}
L = \frac{1}{N} \sum_{i} (y_i - Q(s_i, a_i | \theta^{Q})^2) 
\end{equation}</script>

<p>Here, a minibatch of size <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-14-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-239" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-240" class="mjx-mrow"><span id="MJXc-Node-241" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.269em; padding-right: 0.085em;">N</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">N</script> has been sampled from the replay buffer, with the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-15-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-242" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-243" class="mjx-mrow"><span id="MJXc-Node-244" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.422em; padding-bottom: 0.269em;">i</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-15">i</script> index referring to the i’th sample.  The target for the TD error computation, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-16-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-245" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-246" class="mjx-mrow"><span id="MJXc-Node-247" class="mjx-msubsup"><span class="mjx-base" style="margin-right: -0.006em;"><span id="MJXc-Node-248" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.499em; padding-right: 0.006em;">y</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-249" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.422em; padding-bottom: 0.269em;">i</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>y</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-16">y_i</script>, is computed from the sum of the immediate reward and the outputs of the target actor and critic networks, having weights <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-17-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-250" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-251" class="mjx-mrow"><span id="MJXc-Node-252" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-253" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.269em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-254" class="mjx-texatom"><span id="MJXc-Node-255" class="mjx-mrow"><span id="MJXc-Node-256" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-257" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.499em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-258" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.269em; padding-bottom: 0.308em;">′</span></span></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>μ</mi><mo>′</mo></msup></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-17">\theta^{\mu’}</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-18-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-259" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-260" class="mjx-mrow"><span id="MJXc-Node-261" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-262" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.269em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-263" class="mjx-texatom"><span id="MJXc-Node-264" class="mjx-mrow"><span id="MJXc-Node-265" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-266" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.461em;">Q</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-267" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.269em; padding-bottom: 0.308em;">′</span></span></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>Q</mi><mo>′</mo></msup></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-18">\theta^{Q’}</script> respectively. Then, the critic loss can be computed w.r.t. the output <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-19-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-268" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-269" class="mjx-mrow"><span id="MJXc-Node-270" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.461em;">Q</span></span><span id="MJXc-Node-271" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-272" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-273" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-274" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.422em; padding-bottom: 0.269em;">i</span></span></span></span><span id="MJXc-Node-275" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.151em; padding-bottom: 0.537em;">,</span></span><span id="MJXc-Node-276" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-277" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">a</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-278" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.422em; padding-bottom: 0.269em;">i</span></span></span></span><span id="MJXc-Node-279" class="mjx-texatom"><span id="MJXc-Node-280" class="mjx-mrow"><span id="MJXc-Node-281" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">|</span></span></span></span><span id="MJXc-Node-282" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-283" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.269em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-284" class="mjx-texatom"><span id="MJXc-Node-285" class="mjx-mrow"><span id="MJXc-Node-286" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.461em;">Q</span></span></span></span></span></span><span id="MJXc-Node-287" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>i</mi></msub><mo>,</mo><msub><mi>a</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>Q</mi></mrow></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-19">Q(s_i, a_i | \theta^{Q})</script> of the critic network for the i’th sample.</p>

<p>See <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[4]</a> for more details on the use of target networks.</p>

<p>Now, as mentioned above, the weights of the critic network can be updated with the gradients obtained from the loss function in Eq. 2. Also, remember that the actor network is updated with the Deterministic Policy Gradient. Here lies the crux of DDPG! Silver, et al., <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[3]</a> proved that the stochastic <em>policy gradient</em> <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-20-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-288" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-289" class="mjx-mrow"><span id="MJXc-Node-290" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-291" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.384em; padding-bottom: 0.384em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-292" class="mjx-texatom"><span id="MJXc-Node-293" class="mjx-mrow"><span id="MJXc-Node-294" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.269em;">θ</span></span></span></span></span></span><span id="MJXc-Node-295" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.499em;">μ</span></span><span id="MJXc-Node-296" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">(</span></span><span id="MJXc-Node-297" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">a</span></span><span id="MJXc-Node-298" class="mjx-texatom"><span id="MJXc-Node-299" class="mjx-mrow"><span id="MJXc-Node-300" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">|</span></span></span></span><span id="MJXc-Node-301" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.231em; padding-bottom: 0.269em;">s</span></span><span id="MJXc-Node-302" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.151em; padding-bottom: 0.537em;">,</span></span><span id="MJXc-Node-303" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.499em; padding-bottom: 0.269em;">θ</span></span><span id="MJXc-Node-304" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mi>θ</mi></mrow></msub><mi>μ</mi><mo stretchy="false">(</mo><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>s</mi><mo>,</mo><mi>θ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-20">\nabla_{\theta} \mu (a | s, \theta)</script>, which is the gradient of the policy’s performance, is equivalent to the deterministic policy gradient, which is given by:</p>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display"><span id="MathJax-Element-21-Frame" class="mjx-full-width mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-3&quot;&gt;&lt;mtext&gt;(3)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2248;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;[&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; min-width: 21.868em; position: relative;"><span id="MJXc-Node-305" class="mjx-math" aria-hidden="true" style="width: 100%;"><span id="MJXc-Node-306" class="mjx-mrow" style="width: 100%;"><span id="MJXc-Node-307" class="mjx-mtable" style="width: 100%; min-width: 26.024em;"><span class="mjx-box" style="width: 100%; text-align: center;"><span class="mjx-table" style="display: inline-table; width: auto; vertical-align: 0.038em;"><span id="MJXc-Node-308" class="mjx-mlabeledtr" style="height: 1.432em;"><span id="MJXc-Node-312" class="mjx-mtd" style="padding: 0px; width: 21.868em;"><span id="MJXc-Node-313" class="mjx-mrow" style="margin-top: -0.072em;"><span id="MJXc-Node-314" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-315" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-316" class="mjx-texatom"><span id="MJXc-Node-317" class="mjx-mrow"><span id="MJXc-Node-318" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-319" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-320" class="mjx-texatom"><span id="MJXc-Node-321" class="mjx-mrow"><span id="MJXc-Node-322" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-323" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-324" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.206em; padding-bottom: 0.308em;">≈</span></span><span id="MJXc-Node-325" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-326" class="mjx-texatom"><span id="MJXc-Node-327" class="mjx-mrow"><span id="MJXc-Node-328" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.461em; padding-bottom: 0.308em;">E</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-329" class="mjx-texatom"><span id="MJXc-Node-330" class="mjx-mrow"><span id="MJXc-Node-331" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-332" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-333" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span></span></span></span></span></span></span><span id="MJXc-Node-334" class="mjx-texatom"><span id="MJXc-Node-335" class="mjx-mrow"><span id="MJXc-Node-336" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.614em; padding-bottom: 0.614em;">[</span></span></span></span><span id="MJXc-Node-337" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-338" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-339" class="mjx-texatom"><span id="MJXc-Node-340" class="mjx-mrow"><span id="MJXc-Node-341" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span></span></span></span></span><span id="MJXc-Node-342" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span><span id="MJXc-Node-343" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-344" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-345" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-346" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-347" class="mjx-texatom"><span id="MJXc-Node-348" class="mjx-mrow"><span id="MJXc-Node-349" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-350" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-351" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-352" class="mjx-texatom"><span id="MJXc-Node-353" class="mjx-mrow"><span id="MJXc-Node-354" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span></span></span></span></span><span id="MJXc-Node-355" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-356" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-357" class="mjx-texatom"><span id="MJXc-Node-358" class="mjx-mrow"><span id="MJXc-Node-359" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.437em; padding-right: 0.071em;"><span id="MJXc-Node-360" class="mjx-texatom"><span id="MJXc-Node-361" class="mjx-mrow"><span id="MJXc-Node-362" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-363" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-364" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-365" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-366" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span><span id="MJXc-Node-367" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-368" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-369" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-370" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-371" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-372" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-373" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-374" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span><span id="MJXc-Node-375" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span></span></span></span><span id="MJXc-Node-376" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-377" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-378" class="mjx-texatom"><span id="MJXc-Node-379" class="mjx-mrow"><span id="MJXc-Node-380" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-381" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-382" class="mjx-texatom"><span id="MJXc-Node-383" class="mjx-mrow"><span id="MJXc-Node-384" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-385" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-386" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-387" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-388" class="mjx-texatom"><span id="MJXc-Node-389" class="mjx-mrow"><span id="MJXc-Node-390" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-391" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-392" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-393" class="mjx-texatom"><span id="MJXc-Node-394" class="mjx-mrow"><span id="MJXc-Node-395" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span><span id="MJXc-Node-396" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-397" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-398" class="mjx-texatom"><span id="MJXc-Node-399" class="mjx-mrow"><span id="MJXc-Node-400" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.437em; padding-right: 0.071em;"><span id="MJXc-Node-401" class="mjx-texatom"><span id="MJXc-Node-402" class="mjx-mrow"><span id="MJXc-Node-403" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-404" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-405" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-406" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-407" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span></span></span></span></span><span id="MJXc-Node-408" class="mjx-texatom"><span id="MJXc-Node-409" class="mjx-mrow"><span id="MJXc-Node-410" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.614em; padding-bottom: 0.614em;">]</span></span></span></span><span class="mjx-strut"></span></span></span></span></span></span><span class="mjx-itable" style="vertical-align: top; margin-left: -1.278em;"><span class="mjx-label" style="height: 1.432em;"><span id="mjx-eqn-3" class="mjx-mtd"><span id="MJXc-Node-310" class="mjx-mrow" style="margin-top: -0.072em;"><span id="MJXc-Node-311" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(3)</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-3"><mtext>(3)</mtext></mtd><mtd><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup></mrow></msub><mi>μ</mi><mo>≈</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">E</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msup><mi>μ</mi><mo>′</mo></msup></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo maxsize="1.2em" minsize="1.2em">[</mo></mrow><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>Q</mi></mrow></msup><mo stretchy="false">)</mo><msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mo>=</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><mi>a</mi><mo>=</mo><mi>μ</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></msub><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup></mrow></msub><mi>μ</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup><mo stretchy="false">)</mo><msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mo>=</mo><msub><mi>s</mi><mi>t</mi></msub></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo maxsize="1.2em" minsize="1.2em">]</mo></mrow></mtd></mlabeledtr></mtable></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-21">\begin{equation}

\nabla_{\theta^{\mu}} \mu \approx \mathbb{E}_{\mu'} \big [ \nabla_{a} Q(s, a|\theta^{Q})|_{s=s_t,a=\mu(s_t)} \nabla_{\theta^{\mu}} \mu(s|\theta^{\mu})|_{s=s_t} \big ]
\end{equation}</script>

<p>Notice that the policy term in the expectation is not a distribution over actions. It turns out that all you need is the gradient of the output of the critic network w.r.t. its parameters, multiplied by the gradient of the output of the actor network w.r.t. its parameters, averaged over a minibatch. Simple!</p>

<p>I think the proof of the deterministic policy gradient theorem is quite illuminating, so I’d like to demonstrate it here before moving on to the code.</p>

<div class="theorem">
(Deterministic Policy Gradient Theorem). 
Suppose the Markov Decision Process satisfies the appropriate conditions (see <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[3]</a>). These imply that <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-22-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-411" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-412" class="mjx-mrow"><span id="MJXc-Node-413" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-414" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-415" class="mjx-texatom"><span id="MJXc-Node-416" class="mjx-mrow"><span id="MJXc-Node-417" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-418" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-419" class="mjx-texatom"><span id="MJXc-Node-420" class="mjx-mrow"><span id="MJXc-Node-421" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-422" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-423" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-424" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-425" class="mjx-texatom"><span id="MJXc-Node-426" class="mjx-mrow"><span id="MJXc-Node-427" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-428" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-429" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-430" class="mjx-texatom"><span id="MJXc-Node-431" class="mjx-mrow"><span id="MJXc-Node-432" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span><span id="MJXc-Node-433" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup></mrow></msub><mi>μ</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-22">\nabla_{\theta^{\mu}} \mu(s|\theta^{\mu})</script> and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-23-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-434" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-435" class="mjx-mrow"><span id="MJXc-Node-436" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-437" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-438" class="mjx-texatom"><span id="MJXc-Node-439" class="mjx-mrow"><span id="MJXc-Node-440" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span></span></span></span></span><span id="MJXc-Node-441" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span><span id="MJXc-Node-442" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-443" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-444" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-445" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-446" class="mjx-texatom"><span id="MJXc-Node-447" class="mjx-mrow"><span id="MJXc-Node-448" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-449" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-450" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-451" class="mjx-texatom"><span id="MJXc-Node-452" class="mjx-mrow"><span id="MJXc-Node-453" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span></span></span></span></span><span id="MJXc-Node-454" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>Q</mi></mrow></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-23">\nabla_{a} Q(s, a|\theta^{Q})</script> exist and that the deterministic policy gradient exists. Then, 

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display" style="text-align: center;"><span id="MathJax-Element-24-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2248;&lt;/mo&gt;&lt;msub&gt;&lt;mo&gt;&amp;#x222B;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; text-align: center; position: relative;"><span id="MJXc-Node-455" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-456" class="mjx-mrow"><span id="MJXc-Node-457" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-458" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-459" class="mjx-texatom"><span id="MJXc-Node-460" class="mjx-mrow"><span id="MJXc-Node-461" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-462" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-463" class="mjx-texatom"><span id="MJXc-Node-464" class="mjx-mrow"><span id="MJXc-Node-465" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-466" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-467" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.206em; padding-bottom: 0.308em;">≈</span></span><span id="MJXc-Node-468" class="mjx-msubsup MJXc-space3"><span class="mjx-base" style="margin-right: -0.388em;"><span id="MJXc-Node-469" class="mjx-mo" style="vertical-align: 0.001em; padding-right: 0.388em;"><span class="mjx-char MJXc-TeX-size2-R" style="padding-top: 1.124em; padding-bottom: 1.124em;">∫</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -1.303em; padding-right: 0.071em;"><span id="MJXc-Node-470" class="mjx-texatom"><span id="MJXc-Node-471" class="mjx-mrow"><span id="MJXc-Node-472" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em; padding-right: 0.032em;">S</span></span></span></span></span></span><span id="MJXc-Node-473" class="mjx-msubsup MJXc-space1"><span class="mjx-base"><span id="MJXc-Node-474" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">ρ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-475" class="mjx-texatom"><span id="MJXc-Node-476" class="mjx-mrow"><span id="MJXc-Node-477" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-478" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-479" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span></span></span></span></span></span></span><span id="MJXc-Node-480" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-481" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-482" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-483" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span><span id="MJXc-Node-484" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-485" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-486" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-487" class="mjx-texatom"><span id="MJXc-Node-488" class="mjx-mrow"><span id="MJXc-Node-489" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span></span></span></span></span><span id="MJXc-Node-490" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span><span id="MJXc-Node-491" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-492" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-493" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-494" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-495" class="mjx-texatom"><span id="MJXc-Node-496" class="mjx-mrow"><span id="MJXc-Node-497" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-498" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-499" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-500" class="mjx-texatom"><span id="MJXc-Node-501" class="mjx-mrow"><span id="MJXc-Node-502" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span></span></span></span></span><span id="MJXc-Node-503" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-504" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-505" class="mjx-texatom"><span id="MJXc-Node-506" class="mjx-mrow"><span id="MJXc-Node-507" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.437em; padding-right: 0.071em;"><span id="MJXc-Node-508" class="mjx-texatom"><span id="MJXc-Node-509" class="mjx-mrow"><span id="MJXc-Node-510" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-511" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-512" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-513" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-514" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span><span id="MJXc-Node-515" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-516" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-517" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-518" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-519" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-520" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-521" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-522" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span><span id="MJXc-Node-523" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span></span></span></span><span id="MJXc-Node-524" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-525" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-526" class="mjx-texatom"><span id="MJXc-Node-527" class="mjx-mrow"><span id="MJXc-Node-528" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-529" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-530" class="mjx-texatom"><span id="MJXc-Node-531" class="mjx-mrow"><span id="MJXc-Node-532" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-533" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-534" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-535" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-536" class="mjx-texatom"><span id="MJXc-Node-537" class="mjx-mrow"><span id="MJXc-Node-538" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-539" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-540" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-541" class="mjx-texatom"><span id="MJXc-Node-542" class="mjx-mrow"><span id="MJXc-Node-543" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span><span id="MJXc-Node-544" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-545" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-546" class="mjx-texatom"><span id="MJXc-Node-547" class="mjx-mrow"><span id="MJXc-Node-548" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.437em; padding-right: 0.071em;"><span id="MJXc-Node-549" class="mjx-texatom"><span id="MJXc-Node-550" class="mjx-mrow"><span id="MJXc-Node-551" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-552" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-553" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-554" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-555" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span></span></span></span></span><span id="MJXc-Node-556" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em; padding-right: 0.003em;">d</span></span><span id="MJXc-Node-557" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup></mrow></msub><mi>μ</mi><mo>≈</mo><msub><mo>∫</mo><mrow class="MJX-TeXAtom-ORD"><mi>S</mi></mrow></msub><msup><mi>ρ</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>μ</mi><mo>′</mo></msup></mrow></msup><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo stretchy="false">)</mo><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>Q</mi></mrow></msup><mo stretchy="false">)</mo><msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mo>=</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><mi>a</mi><mo>=</mo><mi>μ</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></msub><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup></mrow></msub><mi>μ</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup><mo stretchy="false">)</mo><msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mo>=</mo><msub><mi>s</mi><mi>t</mi></msub></mrow></msub><mi>d</mi><mi>s</mi></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-24">
\nabla_{\theta^{\mu}} \mu \approx\int_{S} \rho^{\mu'}(s_t) \nabla_{a} Q(s, a|\theta^{Q})|_{s=s_t, a=\mu(s_t)} \nabla_{\theta^{\mu}} \mu(s|\theta^{\mu})|_{s=s_t}  ds
</script>

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display"><span id="MathJax-Element-25-Frame" class="mjx-full-width mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-4&quot;&gt;&lt;mtext&gt;(4)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;[&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; min-width: 19.461em; position: relative;"><span id="MJXc-Node-558" class="mjx-math" aria-hidden="true" style="width: 100%;"><span id="MJXc-Node-559" class="mjx-mrow" style="width: 100%;"><span id="MJXc-Node-560" class="mjx-mtable" style="width: 100%; min-width: 23.617em;"><span class="mjx-box" style="width: 100%; text-align: center;"><span class="mjx-table" style="display: inline-table; width: auto; vertical-align: 0.038em;"><span id="MJXc-Node-561" class="mjx-mlabeledtr" style="height: 1.432em;"><span id="MJXc-Node-565" class="mjx-mtd" style="padding: 0px; width: 19.461em;"><span id="MJXc-Node-566" class="mjx-mrow" style="margin-top: -0.072em;"><span id="MJXc-Node-567" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-568" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-569" class="mjx-texatom"><span id="MJXc-Node-570" class="mjx-mrow"><span id="MJXc-Node-571" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.461em; padding-bottom: 0.308em;">E</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-572" class="mjx-texatom"><span id="MJXc-Node-573" class="mjx-mrow"><span id="MJXc-Node-574" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-575" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-576" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span></span></span></span></span></span></span><span id="MJXc-Node-577" class="mjx-texatom"><span id="MJXc-Node-578" class="mjx-mrow"><span id="MJXc-Node-579" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.614em; padding-bottom: 0.614em;">[</span></span></span></span><span id="MJXc-Node-580" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-581" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-582" class="mjx-texatom"><span id="MJXc-Node-583" class="mjx-mrow"><span id="MJXc-Node-584" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span></span></span></span></span><span id="MJXc-Node-585" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span><span id="MJXc-Node-586" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-587" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-588" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-589" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-590" class="mjx-texatom"><span id="MJXc-Node-591" class="mjx-mrow"><span id="MJXc-Node-592" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-593" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-594" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-595" class="mjx-texatom"><span id="MJXc-Node-596" class="mjx-mrow"><span id="MJXc-Node-597" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span></span></span></span></span><span id="MJXc-Node-598" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-599" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-600" class="mjx-texatom"><span id="MJXc-Node-601" class="mjx-mrow"><span id="MJXc-Node-602" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.437em; padding-right: 0.071em;"><span id="MJXc-Node-603" class="mjx-texatom"><span id="MJXc-Node-604" class="mjx-mrow"><span id="MJXc-Node-605" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-606" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-607" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-608" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-609" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span><span id="MJXc-Node-610" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-611" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-612" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-613" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-614" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-615" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-616" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-617" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span><span id="MJXc-Node-618" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span></span></span></span><span id="MJXc-Node-619" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-620" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-621" class="mjx-texatom"><span id="MJXc-Node-622" class="mjx-mrow"><span id="MJXc-Node-623" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-624" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-625" class="mjx-texatom"><span id="MJXc-Node-626" class="mjx-mrow"><span id="MJXc-Node-627" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-628" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-629" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-630" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-631" class="mjx-texatom"><span id="MJXc-Node-632" class="mjx-mrow"><span id="MJXc-Node-633" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-634" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-635" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.584em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-636" class="mjx-texatom"><span id="MJXc-Node-637" class="mjx-mrow"><span id="MJXc-Node-638" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span></span><span id="MJXc-Node-639" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-640" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-641" class="mjx-texatom"><span id="MJXc-Node-642" class="mjx-mrow"><span id="MJXc-Node-643" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.437em; padding-right: 0.071em;"><span id="MJXc-Node-644" class="mjx-texatom"><span id="MJXc-Node-645" class="mjx-mrow"><span id="MJXc-Node-646" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-647" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-648" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-649" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-650" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.41em; padding-bottom: 0.308em;">t</span></span></span></span></span></span></span></span><span id="MJXc-Node-651" class="mjx-texatom"><span id="MJXc-Node-652" class="mjx-mrow"><span id="MJXc-Node-653" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.614em; padding-bottom: 0.614em;">]</span></span></span></span><span class="mjx-strut"></span></span></span></span></span></span><span class="mjx-itable" style="vertical-align: top; margin-left: -1.278em;"><span class="mjx-label" style="height: 1.432em;"><span id="mjx-eqn-4" class="mjx-mtd"><span id="MJXc-Node-563" class="mjx-mrow" style="margin-top: -0.072em;"><span id="MJXc-Node-564" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(4)</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-4"><mtext>(4)</mtext></mtd><mtd><mo>=</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">E</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msup><mi>μ</mi><mo>′</mo></msup></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo maxsize="1.2em" minsize="1.2em">[</mo></mrow><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>Q</mi></mrow></msup><mo stretchy="false">)</mo><msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mo>=</mo><msub><mi>s</mi><mi>t</mi></msub><mo>,</mo><mi>a</mi><mo>=</mo><mi>μ</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow></msub><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup></mrow></msub><mi>μ</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msup><mo stretchy="false">)</mo><msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mo>=</mo><msub><mi>s</mi><mi>t</mi></msub></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo maxsize="1.2em" minsize="1.2em">]</mo></mrow></mtd></mlabeledtr></mtable></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-25">
\begin{equation}
= \mathbb{E}_{\mu'}  \big[ \nabla_{a} Q(s, a|\theta^{Q})|_{s=s_t, a=\mu(s_t)}  \nabla_{\theta^{\mu}} \mu(s|\theta^{\mu})|_{s=s_t}  \big]
\end{equation}
</script>
</div>

<div class="proof">

For a greedy stochastic policy <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-26-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-654" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-655" class="mjx-mrow"><span id="MJXc-Node-656" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-657" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-658" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-659" class="mjx-texatom"><span id="MJXc-Node-660" class="mjx-mrow"><span id="MJXc-Node-661" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-662" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-663" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-664" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span><span id="MJXc-Node-665" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mo stretchy="false">(</mo><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>s</mi><mo>,</mo><mi>θ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-26"> \mu (a | s, \theta)</script> over a continuous action space, a global maximization step is required at every time step. Rather, we employ a deterministic policy <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-27-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-666" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-667" class="mjx-mrow"><span id="MJXc-Node-668" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-669" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-670" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-671" class="mjx-texatom"><span id="MJXc-Node-672" class="mjx-mrow"><span id="MJXc-Node-673" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-674" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span><span id="MJXc-Node-675" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>μ</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>θ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-27"> \mu (s | \theta) </script> and update the policy parameters by moving them in the direction of the gradient of the action-value function. We take an expectation to average over the suggested directions of improvement from each state w.r.t. the state distribution under the target policy <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-28-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-676" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-677" class="mjx-mrow"><span id="MJXc-Node-678" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-679" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-680" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>μ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-28">\mu'</script>, given by <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-29-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03C1;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-681" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-682" class="mjx-mrow"><span id="MJXc-Node-683" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-684" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">ρ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-685" class="mjx-texatom"><span id="MJXc-Node-686" class="mjx-mrow"><span id="MJXc-Node-687" class="mjx-msup"><span class="mjx-base"><span id="MJXc-Node-688" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.513em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-689" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span></span></span></span></span></span></span><span id="MJXc-Node-690" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-691" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-692" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>ρ</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>μ</mi><mo>′</mo></msup></mrow></msup><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-29">\rho^{\mu'}(s)</script>.

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display"><span id="MathJax-Element-30-Frame" class="mjx-full-width mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-5&quot;&gt;&lt;mtext&gt;(5)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mrow&gt;&lt;mo class=&quot;MJX-variant&quot;&gt;&amp;#x2032;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;[&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; min-width: 16.65em; position: relative;"><span id="MJXc-Node-693" class="mjx-math" aria-hidden="true" style="width: 100%;"><span id="MJXc-Node-694" class="mjx-mrow" style="width: 100%;"><span id="MJXc-Node-695" class="mjx-mtable" style="width: 100%; min-width: 20.806em;"><span class="mjx-box" style="width: 100%; text-align: center;"><span class="mjx-table" style="display: inline-table; width: auto; vertical-align: -0.057em;"><span id="MJXc-Node-696" class="mjx-mlabeledtr" style="height: 1.434em;"><span id="MJXc-Node-700" class="mjx-mtd" style="padding: 0px; width: 16.65em;"><span id="MJXc-Node-701" class="mjx-mrow"><span id="MJXc-Node-702" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-703" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-stack" style="vertical-align: -0.335em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-709" class="mjx-texatom"><span id="MJXc-Node-710" class="mjx-mrow"><span id="MJXc-Node-711" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-704" class="mjx-texatom"><span id="MJXc-Node-705" class="mjx-mrow"><span id="MJXc-Node-706" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span><span id="MJXc-Node-707" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.41em;">+</span></span><span id="MJXc-Node-708" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.359em; padding-bottom: 0.359em;">1</span></span></span></span></span></span></span><span id="MJXc-Node-712" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-713" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-714" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-stack" style="vertical-align: -0.335em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-716" class="mjx-texatom"><span id="MJXc-Node-717" class="mjx-mrow"><span id="MJXc-Node-718" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-715" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span></span></span></span><span id="MJXc-Node-719" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.41em;">+</span></span><span id="MJXc-Node-720" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">α</span></span><span id="MJXc-Node-721" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-722" class="mjx-texatom"><span id="MJXc-Node-723" class="mjx-mrow"><span id="MJXc-Node-724" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.461em; padding-bottom: 0.308em;">E</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.297em; padding-right: 0.071em;"><span id="MJXc-Node-725" class="mjx-texatom"><span id="MJXc-Node-726" class="mjx-mrow"><span id="MJXc-Node-727" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-728" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-729" class="mjx-mrow"><span id="MJXc-Node-730" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span><span id="MJXc-Node-731" class="mjx-texatom"><span id="MJXc-Node-732" class="mjx-mrow"><span id="MJXc-Node-733" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-734" class="mjx-texatom"><span id="MJXc-Node-735" class="mjx-mrow"><span id="MJXc-Node-736" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.614em; padding-bottom: 0.614em;">[</span></span></span></span><span id="MJXc-Node-737" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-738" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-739" class="mjx-texatom"><span id="MJXc-Node-740" class="mjx-mrow"><span id="MJXc-Node-741" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span></span></span></span><span id="MJXc-Node-742" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span><span id="MJXc-Node-743" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-744" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-745" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-746" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-747" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-748" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-749" class="mjx-texatom"><span id="MJXc-Node-750" class="mjx-mrow"><span id="MJXc-Node-751" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-752" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-753" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-stack" style="vertical-align: -0.335em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-755" class="mjx-texatom"><span id="MJXc-Node-756" class="mjx-mrow"><span id="MJXc-Node-757" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-754" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span></span></span></span><span id="MJXc-Node-758" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-759" class="mjx-texatom"><span id="MJXc-Node-760" class="mjx-mrow"><span id="MJXc-Node-761" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-762" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-763" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-stack" style="vertical-align: -0.335em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-765" class="mjx-texatom"><span id="MJXc-Node-766" class="mjx-mrow"><span id="MJXc-Node-767" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-764" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span></span></span></span><span id="MJXc-Node-768" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-769" class="mjx-texatom"><span id="MJXc-Node-770" class="mjx-mrow"><span id="MJXc-Node-771" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.614em; padding-bottom: 0.614em;">]</span></span></span></span><span id="MJXc-Node-772" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.359em;">.</span></span><span class="mjx-strut"></span></span></span></span></span></span><span class="mjx-itable" style="vertical-align: top; margin-left: -1.278em;"><span class="mjx-label" style="height: 1.434em;"><span id="mjx-eqn-5" class="mjx-mtd"><span id="MJXc-Node-698" class="mjx-mrow" style="margin-top: 0.024em;"><span id="MJXc-Node-699" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(5)</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-5"><mtext>(5)</mtext></mtd><mtd><msubsup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msubsup><mo>=</mo><msubsup><mi>θ</mi><mi>k</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msubsup><mo>+</mo><mi>α</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">E</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msup><mi>μ</mi><mrow><mo class="MJX-variant">′</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi></mrow></mrow></msup></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo maxsize="1.2em" minsize="1.2em">[</mo></mrow><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mi>θ</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>μ</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msubsup><mi>θ</mi><mi>k</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msubsup><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msubsup><mi>θ</mi><mi>k</mi><mrow class="MJX-TeXAtom-ORD"><mi>Q</mi></mrow></msubsup><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo maxsize="1.2em" minsize="1.2em">]</mo></mrow><mo>.</mo></mtd></mlabeledtr></mtable></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-30">
\begin{equation}

\theta^{\mu}_{k + 1} = \theta^{\mu}_k + \alpha \mathbb{E}_{\mu'^{k}} \big [ \nabla_{\theta} Q(s, \mu (s|\theta^{\mu}_k)|\theta^{Q}_k)  \big ].

\end{equation}
</script>

By applying the chain rule,

<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="mjx-chtml MJXc-display"><span id="MathJax-Element-31-Frame" class="mjx-full-width mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-6&quot;&gt;&lt;mtext&gt;(6)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;E&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mrow&gt;&lt;mo class=&quot;MJX-variant&quot;&gt;&amp;#x2032;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;[&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x2207;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msubsup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;&amp;#x03BC;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo maxsize=&quot;1.2em&quot; minsize=&quot;1.2em&quot;&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; min-width: 21.822em; position: relative;"><span id="MJXc-Node-773" class="mjx-math" aria-hidden="true" style="width: 100%;"><span id="MJXc-Node-774" class="mjx-mrow" style="width: 100%;"><span id="MJXc-Node-775" class="mjx-mtable" style="width: 100%; min-width: 25.978em;"><span class="mjx-box" style="width: 100%; text-align: center;"><span class="mjx-table" style="display: inline-table; width: auto; vertical-align: 0.02em;"><span id="MJXc-Node-776" class="mjx-mlabeledtr" style="height: 1.588em;"><span id="MJXc-Node-780" class="mjx-mtd" style="padding: 0px; width: 21.822em;"><span id="MJXc-Node-781" class="mjx-mrow"><span id="MJXc-Node-782" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-783" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-stack" style="vertical-align: -0.335em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-789" class="mjx-texatom"><span id="MJXc-Node-790" class="mjx-mrow"><span id="MJXc-Node-791" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-784" class="mjx-texatom"><span id="MJXc-Node-785" class="mjx-mrow"><span id="MJXc-Node-786" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span><span id="MJXc-Node-787" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.41em;">+</span></span><span id="MJXc-Node-788" class="mjx-mn"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.359em; padding-bottom: 0.359em;">1</span></span></span></span></span></span></span><span id="MJXc-Node-792" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-793" class="mjx-msubsup MJXc-space3"><span class="mjx-base"><span id="MJXc-Node-794" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-stack" style="vertical-align: -0.335em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-796" class="mjx-texatom"><span id="MJXc-Node-797" class="mjx-mrow"><span id="MJXc-Node-798" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-795" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span></span></span></span><span id="MJXc-Node-799" class="mjx-mo MJXc-space2"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.41em;">+</span></span><span id="MJXc-Node-800" class="mjx-mi MJXc-space2"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">α</span></span><span id="MJXc-Node-801" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-802" class="mjx-texatom"><span id="MJXc-Node-803" class="mjx-mrow"><span id="MJXc-Node-804" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.461em; padding-bottom: 0.308em;">E</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.297em; padding-right: 0.071em;"><span id="MJXc-Node-805" class="mjx-texatom"><span id="MJXc-Node-806" class="mjx-mrow"><span id="MJXc-Node-807" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-808" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span><span class="mjx-sup" style="font-size: 70.7%; vertical-align: 0.409em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-809" class="mjx-mrow"><span id="MJXc-Node-810" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.257em; padding-bottom: 0.308em;">′</span></span><span id="MJXc-Node-811" class="mjx-texatom"><span id="MJXc-Node-812" class="mjx-mrow"><span id="MJXc-Node-813" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span></span></span></span></span></span></span></span></span></span><span id="MJXc-Node-814" class="mjx-texatom"><span id="MJXc-Node-815" class="mjx-mrow"><span id="MJXc-Node-816" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.614em; padding-bottom: 0.614em;">[</span></span></span></span><span id="MJXc-Node-817" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-818" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.212em; padding-right: 0.071em;"><span id="MJXc-Node-819" class="mjx-texatom"><span id="MJXc-Node-820" class="mjx-mrow"><span id="MJXc-Node-821" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span></span></span></span></span><span id="MJXc-Node-822" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span><span id="MJXc-Node-823" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-824" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-825" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.512em;">,</span></span><span id="MJXc-Node-826" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-827" class="mjx-texatom"><span id="MJXc-Node-828" class="mjx-mrow"><span id="MJXc-Node-829" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-830" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-831" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-stack" style="vertical-align: -0.335em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-833" class="mjx-texatom"><span id="MJXc-Node-834" class="mjx-mrow"><span id="MJXc-Node-835" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.461em;">Q</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-832" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span></span></span></span><span id="MJXc-Node-836" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-837" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-838" class="mjx-texatom"><span id="MJXc-Node-839" class="mjx-mrow"><span id="MJXc-Node-840" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.437em; padding-right: 0.071em;"><span id="MJXc-Node-841" class="mjx-texatom"><span id="MJXc-Node-842" class="mjx-mrow"><span id="MJXc-Node-843" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">a</span></span><span id="MJXc-Node-844" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.104em; padding-bottom: 0.308em;">=</span></span><span id="MJXc-Node-845" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-846" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-847" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-848" class="mjx-texatom"><span id="MJXc-Node-849" class="mjx-mrow"><span id="MJXc-Node-850" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-851" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-852" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-stack" style="vertical-align: -0.335em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-854" class="mjx-texatom"><span id="MJXc-Node-855" class="mjx-mrow"><span id="MJXc-Node-856" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-853" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span></span></span></span><span id="MJXc-Node-857" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span></span></span></span></span><span id="MJXc-Node-858" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-859" class="mjx-mi"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.41em; padding-bottom: 0.359em;">∇</span></span></span><span class="mjx-sub" style="font-size: 70.7%; vertical-align: -0.23em; padding-right: 0.071em;"><span id="MJXc-Node-860" class="mjx-texatom"><span id="MJXc-Node-861" class="mjx-mrow"><span id="MJXc-Node-862" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span></span></span></span><span id="MJXc-Node-863" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span><span id="MJXc-Node-864" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(</span></span><span id="MJXc-Node-865" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.308em;">s</span></span><span id="MJXc-Node-866" class="mjx-texatom"><span id="MJXc-Node-867" class="mjx-mrow"><span id="MJXc-Node-868" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">|</span></span></span></span><span id="MJXc-Node-869" class="mjx-msubsup"><span class="mjx-base"><span id="MJXc-Node-870" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">θ</span></span></span><span class="mjx-stack" style="vertical-align: -0.335em;"><span class="mjx-sup" style="font-size: 70.7%; padding-bottom: 0.255em; padding-left: 0px; padding-right: 0.071em;"><span id="MJXc-Node-872" class="mjx-texatom"><span id="MJXc-Node-873" class="mjx-mrow"><span id="MJXc-Node-874" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.206em; padding-bottom: 0.512em;">μ</span></span></span></span></span><span class="mjx-sub" style="font-size: 70.7%; padding-right: 0.071em;"><span id="MJXc-Node-871" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.308em;">k</span></span></span></span></span><span id="MJXc-Node-875" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">)</span></span><span id="MJXc-Node-876" class="mjx-texatom"><span id="MJXc-Node-877" class="mjx-mrow"><span id="MJXc-Node-878" class="mjx-mo"><span class="mjx-char MJXc-TeX-size1-R" style="padding-top: 0.614em; padding-bottom: 0.614em;">]</span></span></span></span><span id="MJXc-Node-879" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.15em; padding-bottom: 0.359em;">.</span></span><span class="mjx-strut"></span></span></span></span></span></span><span class="mjx-itable" style="vertical-align: top; margin-left: -1.278em;"><span class="mjx-label" style="height: 1.588em;"><span id="mjx-eqn-6" class="mjx-mtd"><span id="MJXc-Node-778" class="mjx-mrow" style="margin-top: 0.024em;"><span id="MJXc-Node-779" class="mjx-mtext"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.614em;">(6)</span></span><span class="mjx-strut"></span></span></span></span></span></span></span></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-6"><mtext>(6)</mtext></mtd><mtd><msubsup><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msubsup><mo>=</mo><msubsup><mi>θ</mi><mi>k</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msubsup><mo>+</mo><mi>α</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">E</mi></mrow><mrow class="MJX-TeXAtom-ORD"><msup><mi>μ</mi><mrow><mo class="MJX-variant">′</mo><mrow class="MJX-TeXAtom-ORD"><mi>k</mi></mrow></mrow></msup></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo maxsize="1.2em" minsize="1.2em">[</mo></mrow><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mi>a</mi></mrow></msub><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msubsup><mi>θ</mi><mi>k</mi><mrow class="MJX-TeXAtom-ORD"><mi>Q</mi></mrow></msubsup><mo stretchy="false">)</mo><msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>a</mi><mo>=</mo><mi>μ</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msubsup><mi>θ</mi><mi>k</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msubsup><mo stretchy="false">)</mo></mrow></msub><msub><mi mathvariant="normal">∇</mi><mrow class="MJX-TeXAtom-ORD"><mi>θ</mi></mrow></msub><mi>μ</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msubsup><mi>θ</mi><mi>k</mi><mrow class="MJX-TeXAtom-ORD"><mi>μ</mi></mrow></msubsup><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mo maxsize="1.2em" minsize="1.2em">]</mo></mrow><mo>.</mo></mtd></mlabeledtr></mtable></math></span></span></span><script type="math/tex; mode=display" id="MathJax-Element-31">
\begin{equation}

\theta^{\mu}_{k + 1} = \theta^{\mu}_k + \alpha \mathbb{E}_{\mu'^{k}} \big [ \nabla_{a} Q(s, a|\theta^{Q}_k)|_{a=\mu(s|\theta^{\mu}_k)} \nabla_{\theta} \mu(s|\theta^{\mu}_k) \big ].

\end{equation}
</script>
</div>

<p>The expectation in the right-hand side of Eq. 6 is exactly what we want. In <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[3]</a>, it is shown that the stochastic policy gradient converges to Eq. 4 in the limit as the variance of the stochastic policy gradient approaches 0. This is significant because it allows for all of the machinery for stochastic policy gradients to be applied to deterministic policy gradients.</p>

<p><a name="Tensorflow"></a></p>

<h2 id="enough-with-the-chit-chat-lets-see-some-code">Enough With The Chit Chat, Let’s See Some Code!</h2>

<p>Let’s get started.</p>

<p>We’re writing code to solve the Pendulum environment in OpenAI gym, which has a low-dimensional state space and a single continuous action within [-2, 2]. The goal is to swing up and balance the pendulum.</p>

<div>
	<div class="image-wrapper">
	
	<img src="http://pemami4911.github.io/img/pendulum.png" alt="" width="" height="">
	
	</div>
	<div>
	
	</div>
</div>

<p>The first part is easy. Set up a data structure to represent your replay buffer. I recommend using a deque from python’s collections library. The replay buffer will return a randomly chosen batch of experiences when queried.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">ReplayBuffer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">buffer_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="nb">buffer</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
        <span class="n">experience</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="nb">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experience</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="nb">buffer</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="nb">buffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">experience</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span>

    <span class="k">def</span> <span class="nf">sample_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="s">'''     
        batch_size specifies the number of experiences to add 
        to the batch. If the replay buffer has less than batch_size
        elements, simply return all of the elements within the buffer.
        Generally, you'll want to wait until the buffer has at least 
        batch_size elements before beginning to sample from it.
        '''</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="n">batch_size</span><span class="p">:</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">buffer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">buffer</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>

        <span class="n">s_batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>
        <span class="n">a_batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>
        <span class="n">r_batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>
        <span class="n">t_batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>
        <span class="n">s2_batch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">_</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">s_batch</span><span class="p">,</span> <span class="n">a_batch</span><span class="p">,</span> <span class="n">r_batch</span><span class="p">,</span> <span class="n">t_batch</span><span class="p">,</span> <span class="n">s2_batch</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deque</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span></code></pre></figure>

<p>Okay, lets define our actor and critic networks. We’re going to use tflearn to condense the boilerplate code.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">ActorNetwork</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">create_actor_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">input_data</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_dim</span><span class="p">])</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">fully_connected</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">fully_connected</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)</span>
        <span class="c"># Final layer weights are init to Uniform[-3e-3, 3e-3]</span>
        <span class="n">w_init</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">initializations</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minval</span><span class="o">=-</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">fully_connected</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_dim</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'tanh'</span><span class="p">,</span> <span class="n">weights_init</span><span class="o">=</span><span class="n">w_init</span><span class="p">)</span>
        <span class="n">scaled_out</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_bound</span><span class="p">)</span> <span class="c"># Scale output to -action_bound to action_bound</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">scaled_out</span> 


<span class="k">class</span> <span class="nc">CriticNetwork</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">create_critic_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">input_data</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_dim</span><span class="p">])</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">input_data</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_dim</span><span class="p">])</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">fully_connected</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)</span>
        <span class="c"># Add the action tensor in the 2nd hidden layer</span>
        <span class="c"># Use two temp layers to get the corresponding weights and biases</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">fully_connected</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">fully_connected</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">net</span><span class="p">,</span><span class="n">t1</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">t2</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">t2</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)</span>
        <span class="c"># linear layer connected to 1 output representing Q(s,a) </span>
        <span class="c"># Weights are init to Uniform[-3e-3, 3e-3]</span>
        <span class="n">w_init</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">initializations</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minval</span><span class="o">=-</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="mf">0.003</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">fully_connected</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">weights_init</span><span class="o">=</span><span class="n">w_init</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">out</span></code></pre></figure>

<p>I would suggest placing these two functions in separate Actor and Critic classes, as shown above. The hyperparameter and layer details for the networks are in the appendix of the DDPG paper <a href="http://pemami4911.github.io/blog/2016/08/21/ddpg-rl.html#References">[5]</a>. The networks for the low-dimensional state-space problems are pretty simple, though. For the actor network, the output is a tanh layer scaled to be between <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-32-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;double-struck&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-880" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-881" class="mjx-mrow"><span id="MJXc-Node-882" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">[</span></span><span id="MJXc-Node-883" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.422em;">−</span></span><span id="MJXc-Node-884" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.269em;">b</span></span><span id="MJXc-Node-885" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.151em; padding-bottom: 0.537em;">,</span></span><span id="MJXc-Node-886" class="mjx-mo MJXc-space1"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.308em; padding-bottom: 0.422em;">+</span></span><span id="MJXc-Node-887" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.269em;">b</span></span><span id="MJXc-Node-888" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.461em; padding-bottom: 0.575em;">]</span></span><span id="MJXc-Node-889" class="mjx-mo"><span class="mjx-char MJXc-TeX-main-R" style="margin-top: -0.151em; padding-bottom: 0.537em;">,</span></span><span id="MJXc-Node-890" class="mjx-mi MJXc-space1"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.461em; padding-bottom: 0.269em;">b</span></span><span id="MJXc-Node-891" class="mjx-mo MJXc-space3"><span class="mjx-char MJXc-TeX-main-R" style="padding-top: 0.269em; padding-bottom: 0.384em;">∈</span></span><span id="MJXc-Node-892" class="mjx-texatom MJXc-space3"><span id="MJXc-Node-893" class="mjx-mrow"><span id="MJXc-Node-894" class="mjx-mi"><span class="mjx-char MJXc-TeX-ams-R" style="padding-top: 0.422em; padding-bottom: 0.308em;">R</span></span></span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>−</mo><mi>b</mi><mo>,</mo><mo>+</mo><mi>b</mi><mo stretchy="false">]</mo><mo>,</mo><mi>b</mi><mo>∈</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="double-struck">R</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-32">[-b, +b], b \in \mathbb{R}</script>. This is useful when your action space is on the real line but is bounded and closed, as is the case for the pendulum task.</p>

<p>Notice that the critic network takes both the state and the action as inputs; however, the action input skips the first layer. This is a design decision that has experimentally worked well. Accommodating this with tflearn was a bit tricky.</p>

<p>Make sure to use Tensorflow placeholders, created by <code class="highlighter-rouge">tflearn.input_data</code>, for the inputs. Leaving the first dimension of the placeholders as <code class="highlighter-rouge">None</code> allows you to train on batches of experiences.</p>

<p>You can simply call these creation methods twice, once to create the actor and critic networks that will be used for training, and again to create your target actor and critic networks.</p>

<p>You can create a Tensorflow Op to update the target network parameters like so:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">network_params</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">()</span>

<span class="bp">self</span><span class="o">.</span><span class="n">target_network_params</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">()[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_params</span><span class="p">):]</span>

<span class="c"># Op for periodically updating target network with online network weights</span>
<span class="bp">self</span><span class="o">.</span><span class="n">update_target_network_params</span> <span class="o">=</span> \
    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_network_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">network_params</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span> <span class="o">+</span> \
        <span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_network_params</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">1.</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_network_params</span><span class="p">))]</span></code></pre></figure>

<p>This looks a bit convoluted, but it’s actually a great display of Tensorflow’s flexibility. You’re defining a Tensorflow Op, <code class="highlighter-rouge">update_target_network_params</code>, that will copy the parameters of the online network with a mixing factor <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span id="MathJax-Element-33-Frame" class="mjx-chtml MathJax_CHTML" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C4;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="font-size: 109%; position: relative;"><span id="MJXc-Node-895" class="mjx-math" aria-hidden="true"><span id="MJXc-Node-896" class="mjx-mrow"><span id="MJXc-Node-897" class="mjx-mi"><span class="mjx-char MJXc-TeX-math-I" style="padding-top: 0.193em; padding-bottom: 0.308em; padding-right: 0.08em;">τ</span></span></span></span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>τ</mi></math></span></span><script type="math/tex" id="MathJax-Element-33">\tau</script>. Make sure you’re copying over the correct Tensorflow variables by checking what is being returned by <code class="highlighter-rouge">tf.trainable_variables()</code>. You’ll need to define this Op for both the actor and critic.</p>

<p>Let’s define the gradient computation and optimization Tensorflow operations. 
We’ll use <a href="https://arxiv.org/abs/1412.6980">ADAM</a> as our optimization method. It’s sort of replaced SGD as the de-facto standard, now that it’s implemented in so many plug-and-play deep-learning libraries such as tflearn and keras and tends to outperform it.</p>

<p>For the actor network…</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># This gradient will be provided by the critic network</span>
<span class="bp">self</span><span class="o">.</span><span class="n">action_gradient</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_dim</span><span class="p">])</span>

<span class="c"># Combine the gradients here </span>
<span class="bp">self</span><span class="o">.</span><span class="n">actor_gradients</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gradients</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_params</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">action_gradient</span><span class="p">)</span>

<span class="c"># Optimization Op</span>
<span class="bp">self</span><span class="o">.</span><span class="n">optimize</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">apply_gradients</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actor_gradients</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">network_params</span><span class="p">))</span></code></pre></figure>

<p>Notice how the gradients are combined. <code class="highlighter-rouge">tf.gradients()</code> makes it quite easy to implement the Deterministic Policy Gradient equation (Eq. 4). I negate the action-value gradient since we want the actor to follow the action-value gradients. Tensorflow will take the sum and average of the gradients of your minibatch.</p>

<p>Then, for the critic network…</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Network target (y_i)</span>
<span class="c"># Obtained from the target networks</span>
<span class="bp">self</span><span class="o">.</span><span class="n">predicted_q_value</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c"># Define loss and optimization Op</span>
<span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="n">tflearn</span><span class="o">.</span><span class="n">mean_square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predicted_q_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">optimize</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loss</span><span class="p">)</span>

<span class="c"># Get the gradient of the net w.r.t. the action</span>
<span class="bp">self</span><span class="o">.</span><span class="n">action_grads</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gradients</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span></code></pre></figure>

<p>This is exactly Eq. 2. Make sure to grab the action-value gradients at the end there to pass to the policy network for gradient computation.</p>

<p>I like to encapsulate calls to my Tensorflow session to keep things organized and readable in my training code. For brevity’s sake, I’ll just show the ones for the actor network.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">...</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">a_gradient</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimize</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span> <span class="n">inputs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_gradient</span><span class="p">:</span> <span class="n">a_gradient</span>
    <span class="p">})</span>

<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_out</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span> <span class="n">inputs</span>
    <span class="p">})</span>

<span class="k">def</span> <span class="nf">predict_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_scaled_out</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_inputs</span><span class="p">:</span> <span class="n">inputs</span>
    <span class="p">})</span>

<span class="k">def</span> <span class="nf">update_target_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_target_network_params</span><span class="p">)</span>

<span class="o">...</span></code></pre></figure>

<p>Now, lets show the main training loop and we’ll be done!</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Constants</span>
<span class="n">TAU</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">ACTOR_LEARNING_RATE</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">CRITIC_LEARNING_RATE</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">1000000</span> 
<span class="n">MINIBATCH_SIZE</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">MAX_EPISODES</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">MAX_EP_STEPS</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">GAMMA</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="o">...</span> 

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
        
    <span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s">'Pendulum-v0'</span><span class="p">)</span>

    <span class="n">state_dim</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">action_dim</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">action_bound</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">high</span>
    <span class="c"># Ensure action bound is symmetric</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">high</span> <span class="o">==</span> <span class="o">-</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">low</span><span class="p">)</span>

    <span class="n">actor</span> <span class="o">=</span> <span class="n">ActorNetwork</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> <span class="n">action_bound</span><span class="p">,</span> \
        <span class="n">ACTOR_LEARNING_RATE</span><span class="p">,</span> <span class="n">TAU</span><span class="p">)</span>

    <span class="n">critic</span> <span class="o">=</span> <span class="n">CriticNetwork</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">state_dim</span><span class="p">,</span> <span class="n">action_dim</span><span class="p">,</span> \
        <span class="n">CRITIC_LEARNING_RATE</span><span class="p">,</span> <span class="n">TAU</span><span class="p">,</span> <span class="n">actor</span><span class="o">.</span><span class="n">get_num_trainable_vars</span><span class="p">())</span>

    <span class="c"># Initialize our Tensorflow variables</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">initialize_all_variables</span><span class="p">())</span>
   
    <span class="c"># Initialize target network weights</span>
    <span class="n">actor</span><span class="o">.</span><span class="n">update_target_network</span><span class="p">()</span>
    <span class="n">critic</span><span class="o">.</span><span class="n">update_target_network</span><span class="p">()</span>

    <span class="c"># Initialize replay memory</span>
    <span class="n">replay_buffer</span> <span class="o">=</span> <span class="n">ReplayBuffer</span><span class="p">(</span><span class="n">BUFFER_SIZE</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">MAX_EPISODES</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">MAX_EP_STEPS</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">RENDER_ENV</span><span class="p">:</span> 
                <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

            <span class="c"># Added exploration noise. In the literature, they use</span>
            <span class="c"># the Ornstein-Uhlenbeck stochastic process for control tasks</span>
            <span class="c"># that deal with momentum</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>

            <span class="n">s2</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">replay_buffer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">s_dim</span><span class="p">,)),</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">a_dim</span><span class="p">,)),</span> <span class="n">r</span><span class="p">,</span> \
                <span class="n">terminal</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="p">(</span><span class="n">actor</span><span class="o">.</span><span class="n">s_dim</span><span class="p">,)))</span>

            <span class="c"># Keep adding experience to the memory until</span>
            <span class="c"># there are at least minibatch size samples</span>
            <span class="k">if</span> <span class="n">replay_buffer</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">MINIBATCH_SIZE</span><span class="p">:</span>     
                <span class="n">s_batch</span><span class="p">,</span> <span class="n">a_batch</span><span class="p">,</span> <span class="n">r_batch</span><span class="p">,</span> <span class="n">t_batch</span><span class="p">,</span> <span class="n">s2_batch</span> <span class="o">=</span> \
                    <span class="n">replay_buffer</span><span class="o">.</span><span class="n">sample_batch</span><span class="p">(</span><span class="n">MINIBATCH_SIZE</span><span class="p">)</span>

                <span class="c"># Calculate targets</span>
                <span class="n">target_q</span> <span class="o">=</span> <span class="n">critic</span><span class="o">.</span><span class="n">predict_target</span><span class="p">(</span><span class="n">s2_batch</span><span class="p">,</span> <span class="n">actor</span><span class="o">.</span><span class="n">predict_target</span><span class="p">(</span><span class="n">s2_batch</span><span class="p">))</span>

                <span class="n">y_i</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">MINIBATCH_SIZE</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">t_batch</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                        <span class="n">y_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_batch</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">y_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_batch</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">GAMMA</span> <span class="o">*</span> <span class="n">target_q</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

                <span class="c"># Update the critic given the targets</span>
                <span class="n">predicted_q_value</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">critic</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">s_batch</span><span class="p">,</span> <span class="n">a_batch</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y_i</span><span class="p">,</span> <span class="p">(</span><span class="n">MINIBATCH_SIZE</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
            
                <span class="c"># Update the actor policy using the sampled gradient</span>
                <span class="n">a_outs</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">s_batch</span><span class="p">)</span>                
                <span class="n">grads</span> <span class="o">=</span> <span class="n">critic</span><span class="o">.</span><span class="n">action_gradients</span><span class="p">(</span><span class="n">s_batch</span><span class="p">,</span> <span class="n">a_outs</span><span class="p">)</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">s_batch</span><span class="p">,</span> <span class="n">grads</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="c"># Update target networks</span>
                <span class="n">actor</span><span class="o">.</span><span class="n">update_target_network</span><span class="p">()</span>
                <span class="n">critic</span><span class="o">.</span><span class="n">update_target_network</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">terminal</span><span class="p">:</span>
                <span class="k">break</span></code></pre></figure>

<p>You’ll want to add book-keeping to the code and arrange things a little more neatly- you can find the full code <a href="https://github.com/pemami4911/deep-rl/tree/master/ddpg">here</a>.</p>

<p>I used Tensorboard to view the total reward per episode and average max Q.
Tensorflow is a bit low-level, so it’s definitely recommended to use tools like tflearn, keras, Tensorboard, etc., on top of it. I am quite pleased with TF though; it’s no surprise that it got so popular so quickly.</p>

<h2 id="looking-forward">Looking Forward</h2>

<div>
	<div class="image-wrapper">
	
	<img src="http://pemami4911.github.io/img/results.png" alt="" width="" height="">
	
	</div>
	<div>
	
	<p class="image-caption">Results from running the code on Pendulum-v0</p>
	
	</div>
</div>

<p>Despite the fact that I ran this code on the courageous CPU of my Macbook Air, it converged relatively quickly to a good solution. Some ways to potentially get better performance (besides running the code on a GPU lol):</p>

<ol>
  <li>
    <p>Use a priority algorithm for sampling from the replay buffer instead of uniformly sampling. See my summary of <a href="http://pemami4911.github.io/papersummaries/2016/01/26/prioritizing-experience-replay.html">Prioritized Experience Replay</a>.</p>
  </li>
  <li>
    <p>Experiment with different stochastic policies to improve exploration.</p>
  </li>
  <li>
    <p>Use recurrent networks to capture temporal nuances within the environment.</p>
  </li>
</ol>

<p>The authors of DDPG also used convolutional neural networks to tackle control tasks of higher complexities. They were able to learn good policies with just pixel inputs, which is really cool.</p>

<p><a name="References"></a></p>

<h2 id="references">References</h2>

<ol>
  <li>Sutton, Richard S., and Andrew G. Barto. <a href="https://webdocs.cs.ualberta.ca/~sutton/book/ebook/the-book.html">Reinforcement learning: An introduction</a>.</li>
  <li><a href="https://webdocs.cs.ualberta.ca/~sutton/book/ebook/node66.html">Reinforcement learning: An introduction - Fig 6.15</a></li>
  <li>Silver, et al. <a href="http://jmlr.org/proceedings/papers/v32/silver14.pdf">Deterministic Policy Gradients</a></li>
  <li>Mnih, et al. <a href="http://www.nature.com/nature/journal/v518/n7540/full/nature14236.html">Human-level control through deep reinforcement learning</a></li>
  <li>Lillicrap, et al. <a href="http://arxiv.org/pdf/1509.02971v2.pdf">Continuous control with Deep Reinforcement Learning</a></li>
  <li><a href="https://webdocs.cs.ualberta.ca/~sutton/book/ebook/node65.html">Reinforcement learning: An introduction - Fig 6.13</a></li>
</ol>


  </div>

  <!--
  <div class="PageNavigation">
     
       <a class="prev" href="/paper-summaries/deep-rl/2016/08/16/Deep-exploration.html">&laquo; Deep Exploration via Bootstrapped DQN</a>
     
     
       <a class="next" href="/paper-summaries/general-ml/2016/08/23/ML-for-genomics.html">Machine Learning in Genomic Medicine: A Review of Computational Problems and Data Sets &raquo;</a>
     
  </div>
  -->
  
</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading small-site-title">Patrick Emami</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list footer-content">
          <li>Powered By <a href="http://github.com/hemangsk/Gravity">Gravity</a></li>
          <li>Made with <i class="fa fa-heart"></i> on <a href="http://jekyllrb.com/"><span style="color:black">{ { Jekyll } }</span></a></li>


        </ul>
      </div>

      <div class="footer-col footer-col-2 footer-content">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/pemami4911"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg>
</span><span class="username">pemami4911</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/patrickomid"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg>
</span><span class="username">patrickomid</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3 site-description">
        <p>My summaries of Machine Learning papers and investigations into various topics concerning artificial intelligence
</p>
      </div>
    </div>

  </div>

</footer>


  


</body></html>